   1               		.file	"action_tapping.c"
   2               	__SP_H__ = 0x3e
   3               	__SP_L__ = 0x3d
   4               	__SREG__ = 0x3f
   5               	__tmp_reg__ = 0
   6               	__zero_reg__ = 1
   7               		.text
   8               	.Ltext0:
   9               		.cfi_sections	.debug_frame
  10               		.section	.text.debug_waiting_buffer,"ax",@progbits
  12               	debug_waiting_buffer:
  13               	.LFB11:
  14               		.file 1 "../../tmk_core/common/action_tapping.c"
   1:../../tmk_core/common/action_tapping.c **** #include <stdint.h>
   2:../../tmk_core/common/action_tapping.c **** #include <stdbool.h>
   3:../../tmk_core/common/action_tapping.c **** #include "action.h"
   4:../../tmk_core/common/action_tapping.c **** #include "action_layer.h"
   5:../../tmk_core/common/action_tapping.c **** #include "action_tapping.h"
   6:../../tmk_core/common/action_tapping.c **** #include "keycode.h"
   7:../../tmk_core/common/action_tapping.c **** #include "timer.h"
   8:../../tmk_core/common/action_tapping.c **** 
   9:../../tmk_core/common/action_tapping.c **** #ifdef DEBUG_ACTION
  10:../../tmk_core/common/action_tapping.c **** #include "debug.h"
  11:../../tmk_core/common/action_tapping.c **** #else
  12:../../tmk_core/common/action_tapping.c **** #include "nodebug.h"
  13:../../tmk_core/common/action_tapping.c **** #endif
  14:../../tmk_core/common/action_tapping.c **** 
  15:../../tmk_core/common/action_tapping.c **** #ifndef NO_ACTION_TAPPING
  16:../../tmk_core/common/action_tapping.c **** 
  17:../../tmk_core/common/action_tapping.c **** #define IS_TAPPING()            !IS_NOEVENT(tapping_key.event)
  18:../../tmk_core/common/action_tapping.c **** #define IS_TAPPING_PRESSED()    (IS_TAPPING() && tapping_key.event.pressed)
  19:../../tmk_core/common/action_tapping.c **** #define IS_TAPPING_RELEASED()   (IS_TAPPING() && !tapping_key.event.pressed)
  20:../../tmk_core/common/action_tapping.c **** #define IS_TAPPING_KEY(k)       (IS_TAPPING() && KEYEQ(tapping_key.event.key, (k)))
  21:../../tmk_core/common/action_tapping.c **** #define WITHIN_TAPPING_TERM(e)  (TIMER_DIFF_16(e.time, tapping_key.event.time) < TAPPING_TERM)
  22:../../tmk_core/common/action_tapping.c **** 
  23:../../tmk_core/common/action_tapping.c **** 
  24:../../tmk_core/common/action_tapping.c **** static keyrecord_t tapping_key = {};
  25:../../tmk_core/common/action_tapping.c **** static keyrecord_t waiting_buffer[WAITING_BUFFER_SIZE] = {};
  26:../../tmk_core/common/action_tapping.c **** static uint8_t waiting_buffer_head = 0;
  27:../../tmk_core/common/action_tapping.c **** static uint8_t waiting_buffer_tail = 0;
  28:../../tmk_core/common/action_tapping.c **** 
  29:../../tmk_core/common/action_tapping.c **** static bool process_tapping(keyrecord_t *record);
  30:../../tmk_core/common/action_tapping.c **** static bool waiting_buffer_enq(keyrecord_t record);
  31:../../tmk_core/common/action_tapping.c **** static void waiting_buffer_clear(void);
  32:../../tmk_core/common/action_tapping.c **** static bool waiting_buffer_typed(keyevent_t event);
  33:../../tmk_core/common/action_tapping.c **** static void waiting_buffer_scan_tap(void);
  34:../../tmk_core/common/action_tapping.c **** static void debug_tapping_key(void);
  35:../../tmk_core/common/action_tapping.c **** static void debug_waiting_buffer(void);
  36:../../tmk_core/common/action_tapping.c **** 
  37:../../tmk_core/common/action_tapping.c **** 
  38:../../tmk_core/common/action_tapping.c **** void action_tapping_process(keyrecord_t record)
  39:../../tmk_core/common/action_tapping.c **** {
  40:../../tmk_core/common/action_tapping.c ****     if (process_tapping(&record)) {
  41:../../tmk_core/common/action_tapping.c ****         if (!IS_NOEVENT(record.event)) {
  42:../../tmk_core/common/action_tapping.c ****             debug("processed: "); debug_record(record); debug("\n");
  43:../../tmk_core/common/action_tapping.c ****         }
  44:../../tmk_core/common/action_tapping.c ****     } else {
  45:../../tmk_core/common/action_tapping.c ****         if (!waiting_buffer_enq(record)) {
  46:../../tmk_core/common/action_tapping.c ****             // clear all in case of overflow.
  47:../../tmk_core/common/action_tapping.c ****             debug("OVERFLOW: CLEAR ALL STATES\n");
  48:../../tmk_core/common/action_tapping.c ****             clear_keyboard();
  49:../../tmk_core/common/action_tapping.c ****             waiting_buffer_clear();
  50:../../tmk_core/common/action_tapping.c ****             tapping_key = (keyrecord_t){};
  51:../../tmk_core/common/action_tapping.c ****         }
  52:../../tmk_core/common/action_tapping.c ****     }
  53:../../tmk_core/common/action_tapping.c **** 
  54:../../tmk_core/common/action_tapping.c ****     // process waiting_buffer
  55:../../tmk_core/common/action_tapping.c ****     if (!IS_NOEVENT(record.event) && waiting_buffer_head != waiting_buffer_tail) {
  56:../../tmk_core/common/action_tapping.c ****         debug("---- action_exec: process waiting_buffer -----\n");
  57:../../tmk_core/common/action_tapping.c ****     }
  58:../../tmk_core/common/action_tapping.c ****     for (; waiting_buffer_tail != waiting_buffer_head; waiting_buffer_tail = (waiting_buffer_tail +
  59:../../tmk_core/common/action_tapping.c ****         if (process_tapping(&waiting_buffer[waiting_buffer_tail])) {
  60:../../tmk_core/common/action_tapping.c ****             debug("processed: waiting_buffer["); debug_dec(waiting_buffer_tail); debug("] = ");
  61:../../tmk_core/common/action_tapping.c ****             debug_record(waiting_buffer[waiting_buffer_tail]); debug("\n\n");
  62:../../tmk_core/common/action_tapping.c ****         } else {
  63:../../tmk_core/common/action_tapping.c ****             break;
  64:../../tmk_core/common/action_tapping.c ****         }
  65:../../tmk_core/common/action_tapping.c ****     }
  66:../../tmk_core/common/action_tapping.c ****     if (!IS_NOEVENT(record.event)) {
  67:../../tmk_core/common/action_tapping.c ****         debug("\n");
  68:../../tmk_core/common/action_tapping.c ****     }
  69:../../tmk_core/common/action_tapping.c **** }
  70:../../tmk_core/common/action_tapping.c **** 
  71:../../tmk_core/common/action_tapping.c **** 
  72:../../tmk_core/common/action_tapping.c **** /* Tapping
  73:../../tmk_core/common/action_tapping.c ****  *
  74:../../tmk_core/common/action_tapping.c ****  * Rule: Tap key is typed(pressed and released) within TAPPING_TERM.
  75:../../tmk_core/common/action_tapping.c ****  *       (without interfering by typing other key)
  76:../../tmk_core/common/action_tapping.c ****  */
  77:../../tmk_core/common/action_tapping.c **** /* return true when key event is processed or consumed. */
  78:../../tmk_core/common/action_tapping.c **** bool process_tapping(keyrecord_t *keyp)
  79:../../tmk_core/common/action_tapping.c **** {
  80:../../tmk_core/common/action_tapping.c ****     keyevent_t event = keyp->event;
  81:../../tmk_core/common/action_tapping.c **** 
  82:../../tmk_core/common/action_tapping.c ****     // if tapping
  83:../../tmk_core/common/action_tapping.c ****     if (IS_TAPPING_PRESSED()) {
  84:../../tmk_core/common/action_tapping.c ****         if (WITHIN_TAPPING_TERM(event)) {
  85:../../tmk_core/common/action_tapping.c ****             if (tapping_key.tap.count == 0) {
  86:../../tmk_core/common/action_tapping.c ****                 if (IS_TAPPING_KEY(event.key) && !event.pressed) {
  87:../../tmk_core/common/action_tapping.c ****                     // first tap!
  88:../../tmk_core/common/action_tapping.c ****                     debug("Tapping: First tap(0->1).\n");
  89:../../tmk_core/common/action_tapping.c ****                     tapping_key.tap.count = 1;
  90:../../tmk_core/common/action_tapping.c ****                     debug_tapping_key();
  91:../../tmk_core/common/action_tapping.c ****                     process_action(&tapping_key);
  92:../../tmk_core/common/action_tapping.c **** 
  93:../../tmk_core/common/action_tapping.c ****                     // copy tapping state
  94:../../tmk_core/common/action_tapping.c ****                     keyp->tap = tapping_key.tap;
  95:../../tmk_core/common/action_tapping.c ****                     // enqueue
  96:../../tmk_core/common/action_tapping.c ****                     return false;
  97:../../tmk_core/common/action_tapping.c ****                 }
  98:../../tmk_core/common/action_tapping.c **** #if TAPPING_TERM >= 500
  99:../../tmk_core/common/action_tapping.c ****                 /* Process a key typed within TAPPING_TERM
 100:../../tmk_core/common/action_tapping.c ****                  * This can register the key before settlement of tapping,
 101:../../tmk_core/common/action_tapping.c ****                  * useful for long TAPPING_TERM but may prevent fast typing.
 102:../../tmk_core/common/action_tapping.c ****                  */
 103:../../tmk_core/common/action_tapping.c ****                 else if (IS_RELEASED(event) && waiting_buffer_typed(event)) {
 104:../../tmk_core/common/action_tapping.c ****                     debug("Tapping: End. No tap. Interfered by typing key\n");
 105:../../tmk_core/common/action_tapping.c ****                     process_action(&tapping_key);
 106:../../tmk_core/common/action_tapping.c ****                     tapping_key = (keyrecord_t){};
 107:../../tmk_core/common/action_tapping.c ****                     debug_tapping_key();
 108:../../tmk_core/common/action_tapping.c ****                     // enqueue
 109:../../tmk_core/common/action_tapping.c ****                     return false;
 110:../../tmk_core/common/action_tapping.c ****                 }
 111:../../tmk_core/common/action_tapping.c **** #endif
 112:../../tmk_core/common/action_tapping.c ****                 /* Process release event of a key pressed before tapping starts
 113:../../tmk_core/common/action_tapping.c ****                  * Without this unexpected repeating will occur with having fast repeating setting
 114:../../tmk_core/common/action_tapping.c ****                  * https://github.com/tmk/tmk_keyboard/issues/60
 115:../../tmk_core/common/action_tapping.c ****                  */
 116:../../tmk_core/common/action_tapping.c ****                 else if (IS_RELEASED(event) && !waiting_buffer_typed(event)) {
 117:../../tmk_core/common/action_tapping.c ****                     // Modifier should be retained till end of this tapping.
 118:../../tmk_core/common/action_tapping.c ****                     action_t action = layer_switch_get_action(event);
 119:../../tmk_core/common/action_tapping.c ****                     switch (action.kind.id) {
 120:../../tmk_core/common/action_tapping.c ****                         case ACT_LMODS:
 121:../../tmk_core/common/action_tapping.c ****                         case ACT_RMODS:
 122:../../tmk_core/common/action_tapping.c ****                             if (action.key.mods && !action.key.code) return false;
 123:../../tmk_core/common/action_tapping.c ****                             if (IS_MOD(action.key.code)) return false;
 124:../../tmk_core/common/action_tapping.c ****                             break;
 125:../../tmk_core/common/action_tapping.c ****                         case ACT_LMODS_TAP:
 126:../../tmk_core/common/action_tapping.c ****                         case ACT_RMODS_TAP:
 127:../../tmk_core/common/action_tapping.c ****                             if (action.key.mods && keyp->tap.count == 0) return false;
 128:../../tmk_core/common/action_tapping.c ****                             if (IS_MOD(action.key.code)) return false;
 129:../../tmk_core/common/action_tapping.c ****                             break;
 130:../../tmk_core/common/action_tapping.c ****                     }
 131:../../tmk_core/common/action_tapping.c ****                     // Release of key should be process immediately.
 132:../../tmk_core/common/action_tapping.c ****                     debug("Tapping: release event of a key pressed before tapping\n");
 133:../../tmk_core/common/action_tapping.c ****                     process_action(keyp);
 134:../../tmk_core/common/action_tapping.c ****                     return true;
 135:../../tmk_core/common/action_tapping.c ****                 }
 136:../../tmk_core/common/action_tapping.c ****                 else {
 137:../../tmk_core/common/action_tapping.c ****                     // set interrupted flag when other key preesed during tapping
 138:../../tmk_core/common/action_tapping.c ****                     if (event.pressed) {
 139:../../tmk_core/common/action_tapping.c ****                         tapping_key.tap.interrupted = true;
 140:../../tmk_core/common/action_tapping.c ****                     }
 141:../../tmk_core/common/action_tapping.c ****                     // enqueue 
 142:../../tmk_core/common/action_tapping.c ****                     return false;
 143:../../tmk_core/common/action_tapping.c ****                 }
 144:../../tmk_core/common/action_tapping.c ****             }
 145:../../tmk_core/common/action_tapping.c ****             // tap_count > 0
 146:../../tmk_core/common/action_tapping.c ****             else {
 147:../../tmk_core/common/action_tapping.c ****                 if (IS_TAPPING_KEY(event.key) && !event.pressed) {
 148:../../tmk_core/common/action_tapping.c ****                     debug("Tapping: Tap release("); debug_dec(tapping_key.tap.count); debug(")\n");
 149:../../tmk_core/common/action_tapping.c ****                     keyp->tap = tapping_key.tap;
 150:../../tmk_core/common/action_tapping.c ****                     process_action(keyp);
 151:../../tmk_core/common/action_tapping.c ****                     tapping_key = *keyp;
 152:../../tmk_core/common/action_tapping.c ****                     debug_tapping_key();
 153:../../tmk_core/common/action_tapping.c ****                     return true;
 154:../../tmk_core/common/action_tapping.c ****                 }
 155:../../tmk_core/common/action_tapping.c ****                 else if (is_tap_key(event) && event.pressed) {
 156:../../tmk_core/common/action_tapping.c ****                     if (tapping_key.tap.count > 1) {
 157:../../tmk_core/common/action_tapping.c ****                         debug("Tapping: Start new tap with releasing last tap(>1).\n");
 158:../../tmk_core/common/action_tapping.c ****                         // unregister key
 159:../../tmk_core/common/action_tapping.c ****                         process_action(&(keyrecord_t){
 160:../../tmk_core/common/action_tapping.c ****                                 .tap = tapping_key.tap,
 161:../../tmk_core/common/action_tapping.c ****                                 .event.key = tapping_key.event.key,
 162:../../tmk_core/common/action_tapping.c ****                                 .event.time = event.time,
 163:../../tmk_core/common/action_tapping.c ****                                 .event.pressed = false
 164:../../tmk_core/common/action_tapping.c ****                         });
 165:../../tmk_core/common/action_tapping.c ****                     } else {
 166:../../tmk_core/common/action_tapping.c ****                         debug("Tapping: Start while last tap(1).\n");
 167:../../tmk_core/common/action_tapping.c ****                     }
 168:../../tmk_core/common/action_tapping.c ****                     tapping_key = *keyp;
 169:../../tmk_core/common/action_tapping.c ****                     waiting_buffer_scan_tap();
 170:../../tmk_core/common/action_tapping.c ****                     debug_tapping_key();
 171:../../tmk_core/common/action_tapping.c ****                     return true;
 172:../../tmk_core/common/action_tapping.c ****                 }
 173:../../tmk_core/common/action_tapping.c ****                 else {
 174:../../tmk_core/common/action_tapping.c ****                     if (!IS_NOEVENT(event)) {
 175:../../tmk_core/common/action_tapping.c ****                         debug("Tapping: key event while last tap(>0).\n");
 176:../../tmk_core/common/action_tapping.c ****                     }
 177:../../tmk_core/common/action_tapping.c ****                     process_action(keyp);
 178:../../tmk_core/common/action_tapping.c ****                     return true;
 179:../../tmk_core/common/action_tapping.c ****                 }
 180:../../tmk_core/common/action_tapping.c ****             }
 181:../../tmk_core/common/action_tapping.c ****         }
 182:../../tmk_core/common/action_tapping.c ****         // after TAPPING_TERM
 183:../../tmk_core/common/action_tapping.c ****         else {
 184:../../tmk_core/common/action_tapping.c ****             if (tapping_key.tap.count == 0) {
 185:../../tmk_core/common/action_tapping.c ****                 debug("Tapping: End. Timeout. Not tap(0): ");
 186:../../tmk_core/common/action_tapping.c ****                 debug_event(event); debug("\n");
 187:../../tmk_core/common/action_tapping.c ****                 process_action(&tapping_key);
 188:../../tmk_core/common/action_tapping.c ****                 tapping_key = (keyrecord_t){};
 189:../../tmk_core/common/action_tapping.c ****                 debug_tapping_key();
 190:../../tmk_core/common/action_tapping.c ****                 return false;
 191:../../tmk_core/common/action_tapping.c ****             }  else {
 192:../../tmk_core/common/action_tapping.c ****                 if (IS_TAPPING_KEY(event.key) && !event.pressed) {
 193:../../tmk_core/common/action_tapping.c ****                     debug("Tapping: End. last timeout tap release(>0).");
 194:../../tmk_core/common/action_tapping.c ****                     keyp->tap = tapping_key.tap;
 195:../../tmk_core/common/action_tapping.c ****                     process_action(keyp);
 196:../../tmk_core/common/action_tapping.c ****                     tapping_key = (keyrecord_t){};
 197:../../tmk_core/common/action_tapping.c ****                     return true;
 198:../../tmk_core/common/action_tapping.c ****                 }
 199:../../tmk_core/common/action_tapping.c ****                 else if (is_tap_key(event) && event.pressed) {
 200:../../tmk_core/common/action_tapping.c ****                     if (tapping_key.tap.count > 1) {
 201:../../tmk_core/common/action_tapping.c ****                         debug("Tapping: Start new tap with releasing last timeout tap(>1).\n");
 202:../../tmk_core/common/action_tapping.c ****                         // unregister key
 203:../../tmk_core/common/action_tapping.c ****                         process_action(&(keyrecord_t){
 204:../../tmk_core/common/action_tapping.c ****                                 .tap = tapping_key.tap,
 205:../../tmk_core/common/action_tapping.c ****                                 .event.key = tapping_key.event.key,
 206:../../tmk_core/common/action_tapping.c ****                                 .event.time = event.time,
 207:../../tmk_core/common/action_tapping.c ****                                 .event.pressed = false
 208:../../tmk_core/common/action_tapping.c ****                         });
 209:../../tmk_core/common/action_tapping.c ****                     } else {
 210:../../tmk_core/common/action_tapping.c ****                         debug("Tapping: Start while last timeout tap(1).\n");
 211:../../tmk_core/common/action_tapping.c ****                     }
 212:../../tmk_core/common/action_tapping.c ****                     tapping_key = *keyp;
 213:../../tmk_core/common/action_tapping.c ****                     waiting_buffer_scan_tap();
 214:../../tmk_core/common/action_tapping.c ****                     debug_tapping_key();
 215:../../tmk_core/common/action_tapping.c ****                     return true;
 216:../../tmk_core/common/action_tapping.c ****                 }
 217:../../tmk_core/common/action_tapping.c ****                 else {
 218:../../tmk_core/common/action_tapping.c ****                     if (!IS_NOEVENT(event)) {
 219:../../tmk_core/common/action_tapping.c ****                         debug("Tapping: key event while last timeout tap(>0).\n");
 220:../../tmk_core/common/action_tapping.c ****                     }
 221:../../tmk_core/common/action_tapping.c ****                     process_action(keyp);
 222:../../tmk_core/common/action_tapping.c ****                     return true;
 223:../../tmk_core/common/action_tapping.c ****                 }
 224:../../tmk_core/common/action_tapping.c ****             }
 225:../../tmk_core/common/action_tapping.c ****         }
 226:../../tmk_core/common/action_tapping.c ****     } else if (IS_TAPPING_RELEASED()) {
 227:../../tmk_core/common/action_tapping.c ****         if (WITHIN_TAPPING_TERM(event)) {
 228:../../tmk_core/common/action_tapping.c ****             if (event.pressed) {
 229:../../tmk_core/common/action_tapping.c ****                 if (IS_TAPPING_KEY(event.key)) {
 230:../../tmk_core/common/action_tapping.c ****                     if (!tapping_key.tap.interrupted && tapping_key.tap.count > 0) {
 231:../../tmk_core/common/action_tapping.c ****                         // sequential tap.
 232:../../tmk_core/common/action_tapping.c ****                         keyp->tap = tapping_key.tap;
 233:../../tmk_core/common/action_tapping.c ****                         if (keyp->tap.count < 15) keyp->tap.count += 1;
 234:../../tmk_core/common/action_tapping.c ****                         debug("Tapping: Tap press("); debug_dec(keyp->tap.count); debug(")\n");
 235:../../tmk_core/common/action_tapping.c ****                         process_action(keyp);
 236:../../tmk_core/common/action_tapping.c ****                         tapping_key = *keyp;
 237:../../tmk_core/common/action_tapping.c ****                         debug_tapping_key();
 238:../../tmk_core/common/action_tapping.c ****                         return true;
 239:../../tmk_core/common/action_tapping.c ****                     } else {
 240:../../tmk_core/common/action_tapping.c ****                         // FIX: start new tap again
 241:../../tmk_core/common/action_tapping.c ****                         tapping_key = *keyp;
 242:../../tmk_core/common/action_tapping.c ****                         return true;
 243:../../tmk_core/common/action_tapping.c ****                     }
 244:../../tmk_core/common/action_tapping.c ****                 } else if (is_tap_key(event)) {
 245:../../tmk_core/common/action_tapping.c ****                     // Sequential tap can be interfered with other tap key.
 246:../../tmk_core/common/action_tapping.c ****                     debug("Tapping: Start with interfering other tap.\n");
 247:../../tmk_core/common/action_tapping.c ****                     tapping_key = *keyp;
 248:../../tmk_core/common/action_tapping.c ****                     waiting_buffer_scan_tap();
 249:../../tmk_core/common/action_tapping.c ****                     debug_tapping_key();
 250:../../tmk_core/common/action_tapping.c ****                     return true;
 251:../../tmk_core/common/action_tapping.c ****                 } else {
 252:../../tmk_core/common/action_tapping.c ****                     // should none in buffer
 253:../../tmk_core/common/action_tapping.c ****                     // FIX: interrupted when other key is pressed
 254:../../tmk_core/common/action_tapping.c ****                     tapping_key.tap.interrupted = true;
 255:../../tmk_core/common/action_tapping.c ****                     process_action(keyp);
 256:../../tmk_core/common/action_tapping.c ****                     return true;
 257:../../tmk_core/common/action_tapping.c ****                 }
 258:../../tmk_core/common/action_tapping.c ****             } else {
 259:../../tmk_core/common/action_tapping.c ****                 if (!IS_NOEVENT(event)) debug("Tapping: other key just after tap.\n");
 260:../../tmk_core/common/action_tapping.c ****                 process_action(keyp);
 261:../../tmk_core/common/action_tapping.c ****                 return true;
 262:../../tmk_core/common/action_tapping.c ****             }
 263:../../tmk_core/common/action_tapping.c ****         } else {
 264:../../tmk_core/common/action_tapping.c ****             // FIX: process_aciton here?
 265:../../tmk_core/common/action_tapping.c ****             // timeout. no sequential tap.
 266:../../tmk_core/common/action_tapping.c ****             debug("Tapping: End(Timeout after releasing last tap): ");
 267:../../tmk_core/common/action_tapping.c ****             debug_event(event); debug("\n");
 268:../../tmk_core/common/action_tapping.c ****             tapping_key = (keyrecord_t){};
 269:../../tmk_core/common/action_tapping.c ****             debug_tapping_key();
 270:../../tmk_core/common/action_tapping.c ****             return false;
 271:../../tmk_core/common/action_tapping.c ****         }
 272:../../tmk_core/common/action_tapping.c ****     }
 273:../../tmk_core/common/action_tapping.c ****     // not tapping state
 274:../../tmk_core/common/action_tapping.c ****     else {
 275:../../tmk_core/common/action_tapping.c ****         if (event.pressed && is_tap_key(event)) {
 276:../../tmk_core/common/action_tapping.c ****             debug("Tapping: Start(Press tap key).\n");
 277:../../tmk_core/common/action_tapping.c ****             tapping_key = *keyp;
 278:../../tmk_core/common/action_tapping.c ****             waiting_buffer_scan_tap();
 279:../../tmk_core/common/action_tapping.c ****             debug_tapping_key();
 280:../../tmk_core/common/action_tapping.c ****             return true;
 281:../../tmk_core/common/action_tapping.c ****         } else {
 282:../../tmk_core/common/action_tapping.c ****             process_action(keyp);
 283:../../tmk_core/common/action_tapping.c ****             return true;
 284:../../tmk_core/common/action_tapping.c ****         }
 285:../../tmk_core/common/action_tapping.c ****     }
 286:../../tmk_core/common/action_tapping.c **** }
 287:../../tmk_core/common/action_tapping.c **** 
 288:../../tmk_core/common/action_tapping.c **** 
 289:../../tmk_core/common/action_tapping.c **** /*
 290:../../tmk_core/common/action_tapping.c ****  * Waiting buffer
 291:../../tmk_core/common/action_tapping.c ****  */
 292:../../tmk_core/common/action_tapping.c **** bool waiting_buffer_enq(keyrecord_t record)
 293:../../tmk_core/common/action_tapping.c **** {
 294:../../tmk_core/common/action_tapping.c ****     if (IS_NOEVENT(record.event)) {
 295:../../tmk_core/common/action_tapping.c ****         return true;
 296:../../tmk_core/common/action_tapping.c ****     }
 297:../../tmk_core/common/action_tapping.c **** 
 298:../../tmk_core/common/action_tapping.c ****     if ((waiting_buffer_head + 1) % WAITING_BUFFER_SIZE == waiting_buffer_tail) {
 299:../../tmk_core/common/action_tapping.c ****         debug("waiting_buffer_enq: Over flow.\n");
 300:../../tmk_core/common/action_tapping.c ****         return false;
 301:../../tmk_core/common/action_tapping.c ****     }
 302:../../tmk_core/common/action_tapping.c **** 
 303:../../tmk_core/common/action_tapping.c ****     waiting_buffer[waiting_buffer_head] = record;
 304:../../tmk_core/common/action_tapping.c ****     waiting_buffer_head = (waiting_buffer_head + 1) % WAITING_BUFFER_SIZE;
 305:../../tmk_core/common/action_tapping.c **** 
 306:../../tmk_core/common/action_tapping.c ****     debug("waiting_buffer_enq: "); debug_waiting_buffer();
 307:../../tmk_core/common/action_tapping.c ****     return true;
 308:../../tmk_core/common/action_tapping.c **** }
 309:../../tmk_core/common/action_tapping.c **** 
 310:../../tmk_core/common/action_tapping.c **** void waiting_buffer_clear(void)
 311:../../tmk_core/common/action_tapping.c **** {
 312:../../tmk_core/common/action_tapping.c ****     waiting_buffer_head = 0;
 313:../../tmk_core/common/action_tapping.c ****     waiting_buffer_tail = 0;
 314:../../tmk_core/common/action_tapping.c **** }
 315:../../tmk_core/common/action_tapping.c **** 
 316:../../tmk_core/common/action_tapping.c **** bool waiting_buffer_typed(keyevent_t event)
 317:../../tmk_core/common/action_tapping.c **** {
 318:../../tmk_core/common/action_tapping.c ****     for (uint8_t i = waiting_buffer_tail; i != waiting_buffer_head; i = (i + 1) % WAITING_BUFFER_SI
 319:../../tmk_core/common/action_tapping.c ****         if (KEYEQ(event.key, waiting_buffer[i].event.key) && event.pressed !=  waiting_buffer[i].ev
 320:../../tmk_core/common/action_tapping.c ****             return true;
 321:../../tmk_core/common/action_tapping.c ****         }
 322:../../tmk_core/common/action_tapping.c ****     }
 323:../../tmk_core/common/action_tapping.c ****     return false;
 324:../../tmk_core/common/action_tapping.c **** }
 325:../../tmk_core/common/action_tapping.c **** 
 326:../../tmk_core/common/action_tapping.c **** /* scan buffer for tapping */
 327:../../tmk_core/common/action_tapping.c **** void waiting_buffer_scan_tap(void)
 328:../../tmk_core/common/action_tapping.c **** {
 329:../../tmk_core/common/action_tapping.c ****     // tapping already is settled
 330:../../tmk_core/common/action_tapping.c ****     if (tapping_key.tap.count > 0) return;
 331:../../tmk_core/common/action_tapping.c ****     // invalid state: tapping_key released && tap.count == 0
 332:../../tmk_core/common/action_tapping.c ****     if (!tapping_key.event.pressed) return;
 333:../../tmk_core/common/action_tapping.c **** 
 334:../../tmk_core/common/action_tapping.c ****     for (uint8_t i = waiting_buffer_tail; i != waiting_buffer_head; i = (i + 1) % WAITING_BUFFER_SI
 335:../../tmk_core/common/action_tapping.c ****         if (IS_TAPPING_KEY(waiting_buffer[i].event.key) &&
 336:../../tmk_core/common/action_tapping.c ****                 !waiting_buffer[i].event.pressed &&
 337:../../tmk_core/common/action_tapping.c ****                 WITHIN_TAPPING_TERM(waiting_buffer[i].event)) {
 338:../../tmk_core/common/action_tapping.c ****             tapping_key.tap.count = 1;
 339:../../tmk_core/common/action_tapping.c ****             waiting_buffer[i].tap.count = 1;
 340:../../tmk_core/common/action_tapping.c ****             process_action(&tapping_key);
 341:../../tmk_core/common/action_tapping.c **** 
 342:../../tmk_core/common/action_tapping.c ****             debug("waiting_buffer_scan_tap: found at ["); debug_dec(i); debug("]\n");
 343:../../tmk_core/common/action_tapping.c ****             debug_waiting_buffer();
 344:../../tmk_core/common/action_tapping.c ****             return;
 345:../../tmk_core/common/action_tapping.c ****         }
 346:../../tmk_core/common/action_tapping.c ****     }
 347:../../tmk_core/common/action_tapping.c **** }
 348:../../tmk_core/common/action_tapping.c **** 
 349:../../tmk_core/common/action_tapping.c **** 
 350:../../tmk_core/common/action_tapping.c **** /*
 351:../../tmk_core/common/action_tapping.c ****  * debug print
 352:../../tmk_core/common/action_tapping.c ****  */
 353:../../tmk_core/common/action_tapping.c **** static void debug_tapping_key(void)
 354:../../tmk_core/common/action_tapping.c **** {
 355:../../tmk_core/common/action_tapping.c ****     debug("TAPPING_KEY="); debug_record(tapping_key); debug("\n");
 356:../../tmk_core/common/action_tapping.c **** }
 357:../../tmk_core/common/action_tapping.c **** 
 358:../../tmk_core/common/action_tapping.c **** static void debug_waiting_buffer(void)
 359:../../tmk_core/common/action_tapping.c **** {
  15               		.loc 1 359 0
  16               		.cfi_startproc
  17 0000 CF93      		push r28
  18               	.LCFI0:
  19               		.cfi_def_cfa_offset 3
  20               		.cfi_offset 28, -2
  21 0002 DF93      		push r29
  22               	.LCFI1:
  23               		.cfi_def_cfa_offset 4
  24               		.cfi_offset 29, -3
  25               	/* prologue: function */
  26               	/* frame size = 0 */
  27               	/* stack size = 2 */
  28               	.L__stack_usage = 2
  29               	.LBB3:
 360:../../tmk_core/common/action_tapping.c ****     debug("{ ");
 361:../../tmk_core/common/action_tapping.c ****     for (uint8_t i = waiting_buffer_tail; i != waiting_buffer_head; i = (i + 1) % WAITING_BUFFER_SI
  30               		.loc 1 361 0
  31 0004 C091 0000 		lds r28,waiting_buffer_tail
  32               	.LVL0:
  33               	.L2:
  34               		.loc 1 361 0 is_stmt 0 discriminator 1
  35 0008 8091 0000 		lds r24,waiting_buffer_head
  36 000c C817      		cp r28,r24
  37 000e 01F0      		breq .L5
 362:../../tmk_core/common/action_tapping.c ****         debug("["); debug_dec(i); debug("]="); debug_record(waiting_buffer[i]); debug(" ");
  38               		.loc 1 362 0 is_stmt 1 discriminator 3
  39 0010 D0E0      		ldi r29,0
  40 0012 CE01      		movw r24,r28
  41 0014 66E0      		ldi r22,lo8(6)
  42 0016 70E0      		ldi r23,0
  43 0018 0E94 0000 		call __mulhi3
  44 001c FC01      		movw r30,r24
  45 001e E050      		subi r30,lo8(-(waiting_buffer))
  46 0020 F040      		sbci r31,hi8(-(waiting_buffer))
  47 0022 4081      		ld r20,Z
  48 0024 5181      		ldd r21,Z+1
  49 0026 6281      		ldd r22,Z+2
  50 0028 7381      		ldd r23,Z+3
  51 002a 8481      		ldd r24,Z+4
  52 002c 9581      		ldd r25,Z+5
  53 002e 0E94 0000 		call debug_record
  54               	.LVL1:
 361:../../tmk_core/common/action_tapping.c ****         debug("["); debug_dec(i); debug("]="); debug_record(waiting_buffer[i]); debug(" ");
  55               		.loc 1 361 0 discriminator 3
  56 0032 2196      		adiw r28,1
  57               	.LVL2:
  58 0034 C770      		andi r28,lo8(7)
  59 0036 00C0      		rjmp .L2
  60               	.LVL3:
  61               	.L5:
  62               	/* epilogue start */
  63               	.LBE3:
 363:../../tmk_core/common/action_tapping.c ****     }
 364:../../tmk_core/common/action_tapping.c ****     debug("}\n");
 365:../../tmk_core/common/action_tapping.c **** }
  64               		.loc 1 365 0
  65 0038 DF91      		pop r29
  66 003a CF91      		pop r28
  67               	.LVL4:
  68 003c 0895      		ret
  69               		.cfi_endproc
  70               	.LFE11:
  72               		.section	.text.debug_tapping_key,"ax",@progbits
  74               	debug_tapping_key:
  75               	.LFB10:
 354:../../tmk_core/common/action_tapping.c ****     debug("TAPPING_KEY="); debug_record(tapping_key); debug("\n");
  76               		.loc 1 354 0
  77               		.cfi_startproc
  78               	/* prologue: function */
  79               	/* frame size = 0 */
  80               	/* stack size = 0 */
  81               	.L__stack_usage = 0
 355:../../tmk_core/common/action_tapping.c **** }
  82               		.loc 1 355 0
  83 0000 4091 0000 		lds r20,tapping_key
  84 0004 5091 0000 		lds r21,tapping_key+1
  85 0008 6091 0000 		lds r22,tapping_key+2
  86 000c 7091 0000 		lds r23,tapping_key+3
  87 0010 8091 0000 		lds r24,tapping_key+4
  88 0014 9091 0000 		lds r25,tapping_key+5
  89 0018 0C94 0000 		jmp debug_record
  90               	.LVL5:
  91               		.cfi_endproc
  92               	.LFE10:
  94               		.section	.text.waiting_buffer_scan_tap,"ax",@progbits
  96               	waiting_buffer_scan_tap:
  97               	.LFB9:
 328:../../tmk_core/common/action_tapping.c ****     // tapping already is settled
  98               		.loc 1 328 0
  99               		.cfi_startproc
 100 0000 1F93      		push r17
 101               	.LCFI2:
 102               		.cfi_def_cfa_offset 3
 103               		.cfi_offset 17, -2
 104 0002 CF93      		push r28
 105               	.LCFI3:
 106               		.cfi_def_cfa_offset 4
 107               		.cfi_offset 28, -3
 108 0004 DF93      		push r29
 109               	.LCFI4:
 110               		.cfi_def_cfa_offset 5
 111               		.cfi_offset 29, -4
 112               	/* prologue: function */
 113               	/* frame size = 0 */
 114               	/* stack size = 3 */
 115               	.L__stack_usage = 3
 330:../../tmk_core/common/action_tapping.c ****     // invalid state: tapping_key released && tap.count == 0
 116               		.loc 1 330 0
 117 0006 8091 0000 		lds r24,tapping_key+5
 118 000a 8295      		swap r24
 119 000c 8F70      		andi r24,lo8(15)
 120 000e 01F0      		breq .+2
 121 0010 00C0      		rjmp .L7
 332:../../tmk_core/common/action_tapping.c **** 
 122               		.loc 1 332 0
 123 0012 8091 0000 		lds r24,tapping_key+2
 124 0016 8823      		tst r24
 125 0018 01F4      		brne .+2
 126 001a 00C0      		rjmp .L7
 127               	.LBB7:
 334:../../tmk_core/common/action_tapping.c ****         if (IS_TAPPING_KEY(waiting_buffer[i].event.key) &&
 128               		.loc 1 334 0
 129 001c 2091 0000 		lds r18,waiting_buffer_tail
 130               	.LVL6:
 131 0020 1091 0000 		lds r17,waiting_buffer_head
 132 0024 C091 0000 		lds r28,tapping_key
 133 0028 D091 0000 		lds r29,tapping_key+1
 134 002c E091 0000 		lds r30,tapping_key+3
 135 0030 F091 0000 		lds r31,tapping_key+3+1
 136               	.LBB8:
 137               	.LBB9:
 138               		.file 2 "../../tmk_core/common/keyboard.h"
   1:../../tmk_core/common/keyboard.h **** /*
   2:../../tmk_core/common/keyboard.h **** Copyright 2011,2012,2013 Jun Wako <wakojun@gmail.com>
   3:../../tmk_core/common/keyboard.h **** 
   4:../../tmk_core/common/keyboard.h **** This program is free software: you can redistribute it and/or modify
   5:../../tmk_core/common/keyboard.h **** it under the terms of the GNU General Public License as published by
   6:../../tmk_core/common/keyboard.h **** the Free Software Foundation, either version 2 of the License, or
   7:../../tmk_core/common/keyboard.h **** (at your option) any later version.
   8:../../tmk_core/common/keyboard.h **** 
   9:../../tmk_core/common/keyboard.h **** This program is distributed in the hope that it will be useful,
  10:../../tmk_core/common/keyboard.h **** but WITHOUT ANY WARRANTY; without even the implied warranty of
  11:../../tmk_core/common/keyboard.h **** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  12:../../tmk_core/common/keyboard.h **** GNU General Public License for more details.
  13:../../tmk_core/common/keyboard.h **** 
  14:../../tmk_core/common/keyboard.h **** You should have received a copy of the GNU General Public License
  15:../../tmk_core/common/keyboard.h **** along with this program.  If not, see <http://www.gnu.org/licenses/>.
  16:../../tmk_core/common/keyboard.h **** */
  17:../../tmk_core/common/keyboard.h **** 
  18:../../tmk_core/common/keyboard.h **** #ifndef KEYBOARD_H
  19:../../tmk_core/common/keyboard.h **** #define KEYBOARD_H
  20:../../tmk_core/common/keyboard.h **** 
  21:../../tmk_core/common/keyboard.h **** #include <stdbool.h>
  22:../../tmk_core/common/keyboard.h **** #include <stdint.h>
  23:../../tmk_core/common/keyboard.h **** 
  24:../../tmk_core/common/keyboard.h **** 
  25:../../tmk_core/common/keyboard.h **** #ifdef __cplusplus
  26:../../tmk_core/common/keyboard.h **** extern "C" {
  27:../../tmk_core/common/keyboard.h **** #endif
  28:../../tmk_core/common/keyboard.h **** 
  29:../../tmk_core/common/keyboard.h **** /* key matrix position */
  30:../../tmk_core/common/keyboard.h **** typedef struct {
  31:../../tmk_core/common/keyboard.h ****     uint8_t col;
  32:../../tmk_core/common/keyboard.h ****     uint8_t row;
  33:../../tmk_core/common/keyboard.h **** } keypos_t;
  34:../../tmk_core/common/keyboard.h **** 
  35:../../tmk_core/common/keyboard.h **** /* key event */
  36:../../tmk_core/common/keyboard.h **** typedef struct {
  37:../../tmk_core/common/keyboard.h ****     keypos_t key;
  38:../../tmk_core/common/keyboard.h ****     bool     pressed;
  39:../../tmk_core/common/keyboard.h ****     uint16_t time;
  40:../../tmk_core/common/keyboard.h **** } keyevent_t;
  41:../../tmk_core/common/keyboard.h **** 
  42:../../tmk_core/common/keyboard.h **** /* equivalent test of keypos_t */
  43:../../tmk_core/common/keyboard.h **** #define KEYEQ(keya, keyb)       ((keya).row == (keyb).row && (keya).col == (keyb).col)
  44:../../tmk_core/common/keyboard.h **** 
  45:../../tmk_core/common/keyboard.h **** /* Rules for No Event:
  46:../../tmk_core/common/keyboard.h ****  * 1) (time == 0) to handle (keyevent_t){} as empty event
  47:../../tmk_core/common/keyboard.h ****  * 2) Matrix(255, 255) to make TICK event available
  48:../../tmk_core/common/keyboard.h ****  */
  49:../../tmk_core/common/keyboard.h **** static inline bool IS_NOEVENT(keyevent_t event) { return event.time == 0 || (event.key.row == 255 &
 139               		.loc 2 49 0
 140 0034 81E0      		ldi r24,lo8(1)
 141 0036 CF3F      		cpi r28,lo8(-1)
 142 0038 01F0      		breq .L9
 143 003a 80E0      		ldi r24,0
 144               	.L9:
 145 003c 482F      		mov r20,r24
 146               	.LVL7:
 147               	.L10:
 148               	.LBE9:
 149               	.LBE8:
 334:../../tmk_core/common/action_tapping.c ****         if (IS_TAPPING_KEY(waiting_buffer[i].event.key) &&
 150               		.loc 1 334 0 discriminator 1
 151 003e 2117      		cp r18,r17
 152 0040 01F4      		brne .+2
 153 0042 00C0      		rjmp .L7
 154               	.LBB11:
 155               	.LBB10:
 156               		.loc 2 49 0
 157 0044 3097      		sbiw r30,0
 158 0046 01F0      		breq .L18
 159 0048 DF3F      		cpi r29,lo8(-1)
 160 004a 01F0      		breq .L19
 161 004c 80E0      		ldi r24,0
 162 004e 00C0      		rjmp .L11
 163               	.L18:
 164 0050 81E0      		ldi r24,lo8(1)
 165 0052 00C0      		rjmp .L11
 166               	.L19:
 167 0054 842F      		mov r24,r20
 168               	.L11:
 169 0056 30E0      		ldi r19,0
 170               	.LBE10:
 171               	.LBE11:
 335:../../tmk_core/common/action_tapping.c ****                 !waiting_buffer[i].event.pressed &&
 172               		.loc 1 335 0
 173 0058 80FD      		sbrc r24,0
 174 005a 00C0      		rjmp .L12
 335:../../tmk_core/common/action_tapping.c ****                 !waiting_buffer[i].event.pressed &&
 175               		.loc 1 335 0 is_stmt 0 discriminator 1
 176 005c C901      		movw r24,r18
 177 005e 66E0      		ldi r22,lo8(6)
 178 0060 70E0      		ldi r23,0
 179 0062 0E94 0000 		call __mulhi3
 180 0066 DC01      		movw r26,r24
 181 0068 A050      		subi r26,lo8(-(waiting_buffer))
 182 006a B040      		sbci r27,hi8(-(waiting_buffer))
 183 006c 1196      		adiw r26,1
 184 006e 8C91      		ld r24,X
 185 0070 1197      		sbiw r26,1
 186 0072 8D13      		cpse r24,r29
 187 0074 00C0      		rjmp .L12
 335:../../tmk_core/common/action_tapping.c ****                 !waiting_buffer[i].event.pressed &&
 188               		.loc 1 335 0 discriminator 2
 189 0076 8C91      		ld r24,X
 190 0078 8C13      		cpse r24,r28
 191 007a 00C0      		rjmp .L12
 335:../../tmk_core/common/action_tapping.c ****                 !waiting_buffer[i].event.pressed &&
 192               		.loc 1 335 0 discriminator 3
 193 007c 1296      		adiw r26,2
 194 007e 8C91      		ld r24,X
 195 0080 1297      		sbiw r26,2
 196 0082 8111      		cpse r24,__zero_reg__
 197 0084 00C0      		rjmp .L12
 337:../../tmk_core/common/action_tapping.c ****             tapping_key.tap.count = 1;
 198               		.loc 1 337 0 is_stmt 1
 199 0086 1396      		adiw r26,3
 200 0088 8D91      		ld r24,X+
 201 008a 9C91      		ld r25,X
 202 008c 1497      		sbiw r26,3+1
 203 008e 8E17      		cp r24,r30
 204 0090 9F07      		cpc r25,r31
 205 0092 00F4      		brsh .L28
 337:../../tmk_core/common/action_tapping.c ****             tapping_key.tap.count = 1;
 206               		.loc 1 337 0 is_stmt 0 discriminator 2
 207 0094 0197      		sbiw r24,1
 208               	.L28:
 209 0096 8E1B      		sub r24,r30
 210 0098 9F0B      		sbc r25,r31
 211 009a 883C      		cpi r24,-56
 212 009c 9105      		cpc r25,__zero_reg__
 213 009e 00F4      		brsh .L12
 338:../../tmk_core/common/action_tapping.c ****             waiting_buffer[i].tap.count = 1;
 214               		.loc 1 338 0 is_stmt 1
 215 00a0 8091 0000 		lds r24,tapping_key+5
 216 00a4 8F70      		andi r24,lo8(15)
 217 00a6 8061      		ori r24,lo8(16)
 218 00a8 8093 0000 		sts tapping_key+5,r24
 339:../../tmk_core/common/action_tapping.c ****             process_action(&tapping_key);
 219               		.loc 1 339 0
 220 00ac C901      		movw r24,r18
 221 00ae 66E0      		ldi r22,lo8(6)
 222 00b0 70E0      		ldi r23,0
 223 00b2 0E94 0000 		call __mulhi3
 224 00b6 FC01      		movw r30,r24
 225 00b8 E050      		subi r30,lo8(-(waiting_buffer+5))
 226 00ba F040      		sbci r31,hi8(-(waiting_buffer+5))
 227 00bc 9081      		ld r25,Z
 228 00be 9F70      		andi r25,lo8(15)
 229 00c0 9061      		ori r25,lo8(16)
 230 00c2 9083      		st Z,r25
 340:../../tmk_core/common/action_tapping.c **** 
 231               		.loc 1 340 0
 232 00c4 80E0      		ldi r24,lo8(tapping_key)
 233 00c6 90E0      		ldi r25,hi8(tapping_key)
 234 00c8 0E94 0000 		call process_action
 235               	.LVL8:
 236               	/* epilogue start */
 237               	.LBE7:
 347:../../tmk_core/common/action_tapping.c **** 
 238               		.loc 1 347 0
 239 00cc DF91      		pop r29
 240 00ce CF91      		pop r28
 241 00d0 1F91      		pop r17
 242               	.LBB12:
 343:../../tmk_core/common/action_tapping.c ****             return;
 243               		.loc 1 343 0
 244 00d2 0C94 0000 		jmp debug_waiting_buffer
 245               	.LVL9:
 246               	.L12:
 334:../../tmk_core/common/action_tapping.c ****         if (IS_TAPPING_KEY(waiting_buffer[i].event.key) &&
 247               		.loc 1 334 0 discriminator 2
 248 00d6 2F5F      		subi r18,-1
 249 00d8 3F4F      		sbci r19,-1
 250               	.LVL10:
 251 00da 2770      		andi r18,lo8(7)
 252 00dc 00C0      		rjmp .L10
 253               	.L7:
 254               	/* epilogue start */
 255               	.LBE12:
 347:../../tmk_core/common/action_tapping.c **** 
 256               		.loc 1 347 0
 257 00de DF91      		pop r29
 258 00e0 CF91      		pop r28
 259 00e2 1F91      		pop r17
 260 00e4 0895      		ret
 261               		.cfi_endproc
 262               	.LFE9:
 264               		.section	.text.process_tapping,"ax",@progbits
 266               	process_tapping:
 267               	.LFB5:
  79:../../tmk_core/common/action_tapping.c ****     keyevent_t event = keyp->event;
 268               		.loc 1 79 0
 269               		.cfi_startproc
 270               	.LVL11:
 271 0000 AF92      		push r10
 272               	.LCFI5:
 273               		.cfi_def_cfa_offset 3
 274               		.cfi_offset 10, -2
 275 0002 BF92      		push r11
 276               	.LCFI6:
 277               		.cfi_def_cfa_offset 4
 278               		.cfi_offset 11, -3
 279 0004 CF92      		push r12
 280               	.LCFI7:
 281               		.cfi_def_cfa_offset 5
 282               		.cfi_offset 12, -4
 283 0006 DF92      		push r13
 284               	.LCFI8:
 285               		.cfi_def_cfa_offset 6
 286               		.cfi_offset 13, -5
 287 0008 EF92      		push r14
 288               	.LCFI9:
 289               		.cfi_def_cfa_offset 7
 290               		.cfi_offset 14, -6
 291 000a FF92      		push r15
 292               	.LCFI10:
 293               		.cfi_def_cfa_offset 8
 294               		.cfi_offset 15, -7
 295 000c 0F93      		push r16
 296               	.LCFI11:
 297               		.cfi_def_cfa_offset 9
 298               		.cfi_offset 16, -8
 299 000e 1F93      		push r17
 300               	.LCFI12:
 301               		.cfi_def_cfa_offset 10
 302               		.cfi_offset 17, -9
 303 0010 CF93      		push r28
 304               	.LCFI13:
 305               		.cfi_def_cfa_offset 11
 306               		.cfi_offset 28, -10
 307 0012 DF93      		push r29
 308               	.LCFI14:
 309               		.cfi_def_cfa_offset 12
 310               		.cfi_offset 29, -11
 311 0014 CDB7      		in r28,__SP_L__
 312 0016 DEB7      		in r29,__SP_H__
 313               	.LCFI15:
 314               		.cfi_def_cfa_register 28
 315 0018 6197      		sbiw r28,17
 316               	.LCFI16:
 317               		.cfi_def_cfa_offset 29
 318 001a 0FB6      		in __tmp_reg__,__SREG__
 319 001c F894      		cli
 320 001e DEBF      		out __SP_H__,r29
 321 0020 0FBE      		out __SREG__,__tmp_reg__
 322 0022 CDBF      		out __SP_L__,r28
 323               	/* prologue: function */
 324               	/* frame size = 17 */
 325               	/* stack size = 27 */
 326               	.L__stack_usage = 27
 327 0024 7C01      		movw r14,r24
  80:../../tmk_core/common/action_tapping.c **** 
 328               		.loc 1 80 0
 329 0026 85E0      		ldi r24,lo8(5)
 330               	.LVL12:
 331 0028 F701      		movw r30,r14
 332 002a DE01      		movw r26,r28
 333 002c 1D96      		adiw r26,13
 334               		0:
 335 002e 0190      		ld r0,Z+
 336 0030 0D92      		st X+,r0
 337 0032 8A95      		dec r24
 338 0034 01F4      		brne 0b
 339 0036 D701      		movw r26,r14
 340 0038 4C91      		ld r20,X
 341               	.LVL13:
 342 003a 1196      		adiw r26,1
 343 003c 2C91      		ld r18,X
 344 003e 1197      		sbiw r26,1
 345               	.LVL14:
 346 0040 1296      		adiw r26,2
 347 0042 DC90      		ld r13,X
 348 0044 1297      		sbiw r26,2
 349               	.LVL15:
 350 0046 1396      		adiw r26,3
 351 0048 0D91      		ld r16,X+
 352 004a 1C91      		ld r17,X
 353 004c 1497      		sbiw r26,3+1
 354               	.LVL16:
 355 004e 5091 0000 		lds r21,tapping_key
 356 0052 6091 0000 		lds r22,tapping_key+1
 357 0056 8091 0000 		lds r24,tapping_key+3
 358 005a 9091 0000 		lds r25,tapping_key+3+1
 359               	.LBB23:
 360               	.LBB24:
 361               		.loc 2 49 0
 362 005e 0097      		sbiw r24,0
 363 0060 01F0      		breq .L72
 364 0062 6F3F      		cpi r22,lo8(-1)
 365 0064 01F4      		brne .L73
 366 0066 31E0      		ldi r19,lo8(1)
 367 0068 5F3F      		cpi r21,lo8(-1)
 368 006a 01F4      		brne .L73
 369 006c 00C0      		rjmp .L30
 370               	.L72:
 371 006e 31E0      		ldi r19,lo8(1)
 372 0070 00C0      		rjmp .L30
 373               	.L73:
 374 0072 30E0      		ldi r19,0
 375               	.L30:
 376               	.LBE24:
 377               	.LBE23:
  83:../../tmk_core/common/action_tapping.c ****         if (WITHIN_TAPPING_TERM(event)) {
 378               		.loc 1 83 0
 379 0074 B32F      		mov r27,r19
 380 0076 B170      		andi r27,lo8(1)
 381 0078 BB2E      		mov r11,r27
 382 007a 30FD      		sbrc r19,0
 383 007c 00C0      		rjmp .L32
  83:../../tmk_core/common/action_tapping.c ****         if (WITHIN_TAPPING_TERM(event)) {
 384               		.loc 1 83 0 is_stmt 0 discriminator 1
 385 007e A090 0000 		lds r10,tapping_key+2
 386 0082 AA20      		tst r10
 387 0084 01F4      		brne .+2
 388 0086 00C0      		rjmp .L33
 389 0088 3091 0000 		lds r19,tapping_key+5
  84:../../tmk_core/common/action_tapping.c ****             if (tapping_key.tap.count == 0) {
 390               		.loc 1 84 0 is_stmt 1
 391 008c 0817      		cp r16,r24
 392 008e 1907      		cpc r17,r25
 393 0090 00F0      		brlo .L34
  84:../../tmk_core/common/action_tapping.c ****             if (tapping_key.tap.count == 0) {
 394               		.loc 1 84 0 is_stmt 0 discriminator 1
 395 0092 F801      		movw r30,r16
 396 0094 E81B      		sub r30,r24
 397 0096 F90B      		sbc r31,r25
 398 0098 CF01      		movw r24,r30
 399 009a 00C0      		rjmp .L137
 400               	.L34:
  84:../../tmk_core/common/action_tapping.c ****             if (tapping_key.tap.count == 0) {
 401               		.loc 1 84 0 discriminator 2
 402 009c 8095      		com r24
 403 009e 9095      		com r25
 404 00a0 800F      		add r24,r16
 405 00a2 911F      		adc r25,r17
 406               	.L137:
 407 00a4 CC24      		clr r12
 408 00a6 C394      		inc r12
 409 00a8 883C      		cpi r24,-56
 410 00aa 9105      		cpc r25,__zero_reg__
 411 00ac 00F0      		brlo .L93
 412 00ae C12C      		mov r12,__zero_reg__
 184:../../tmk_core/common/action_tapping.c ****                 debug("Tapping: End. Timeout. Not tap(0): ");
 413               		.loc 1 184 0 is_stmt 1 discriminator 2
 414 00b0 307F      		andi r19,lo8(-16)
 415 00b2 01F0      		breq .+2
 416 00b4 00C0      		rjmp .L60
 186:../../tmk_core/common/action_tapping.c ****                 process_action(&tapping_key);
 417               		.loc 1 186 0
 418 00b6 702F      		mov r23,r16
 419 00b8 198B      		std Y+17,r17
 420 00ba 088B      		std Y+16,r16
 421 00bc 522F      		mov r21,r18
 422 00be 6D2D      		mov r22,r13
 423 00c0 8989      		ldd r24,Y+17
 424 00c2 0E94 0000 		call debug_event
 425               	.LVL17:
 187:../../tmk_core/common/action_tapping.c ****                 tapping_key = (keyrecord_t){};
 426               		.loc 1 187 0
 427 00c6 80E0      		ldi r24,lo8(tapping_key)
 428 00c8 90E0      		ldi r25,hi8(tapping_key)
 429 00ca 0E94 0000 		call process_action
 430               	.LVL18:
 431 00ce 00C0      		rjmp .L134
 432               	.LVL19:
 433               	.L93:
  85:../../tmk_core/common/action_tapping.c ****                 if (IS_TAPPING_KEY(event.key) && !event.pressed) {
 434               		.loc 1 85 0
 435 00d0 832F      		mov r24,r19
 436 00d2 807F      		andi r24,lo8(-16)
 437 00d4 01F0      		breq .+2
 438 00d6 00C0      		rjmp .L39
  86:../../tmk_core/common/action_tapping.c ****                     // first tap!
 439               		.loc 1 86 0 discriminator 1
 440 00d8 2613      		cpse r18,r22
 441 00da 00C0      		rjmp .L40
  86:../../tmk_core/common/action_tapping.c ****                     // first tap!
 442               		.loc 1 86 0 is_stmt 0 discriminator 2
 443 00dc 4513      		cpse r20,r21
 444 00de 00C0      		rjmp .L40
  86:../../tmk_core/common/action_tapping.c ****                     // first tap!
 445               		.loc 1 86 0 discriminator 3
 446 00e0 CD2C      		mov r12,r13
 447 00e2 D110      		cpse r13,__zero_reg__
 448 00e4 00C0      		rjmp .L40
 449               	.LVL20:
  89:../../tmk_core/common/action_tapping.c ****                     debug_tapping_key();
 450               		.loc 1 89 0 is_stmt 1
 451 00e6 3F70      		andi r19,lo8(15)
 452 00e8 3061      		ori r19,lo8(16)
 453 00ea 3093 0000 		sts tapping_key+5,r19
  90:../../tmk_core/common/action_tapping.c ****                     process_action(&tapping_key);
 454               		.loc 1 90 0
 455 00ee 0E94 0000 		call debug_tapping_key
 456               	.LVL21:
  91:../../tmk_core/common/action_tapping.c **** 
 457               		.loc 1 91 0
 458 00f2 80E0      		ldi r24,lo8(tapping_key)
 459 00f4 90E0      		ldi r25,hi8(tapping_key)
 460 00f6 0E94 0000 		call process_action
 461               	.LVL22:
  94:../../tmk_core/common/action_tapping.c ****                     // enqueue
 462               		.loc 1 94 0
 463 00fa 8091 0000 		lds r24,tapping_key+5
 464 00fe D701      		movw r26,r14
 465 0100 1596      		adiw r26,5
 466 0102 8C93      		st X,r24
  96:../../tmk_core/common/action_tapping.c ****                 }
 467               		.loc 1 96 0
 468 0104 00C0      		rjmp .L95
 469               	.LVL23:
 470               	.L40:
 471               	.LBB25:
 472               	.LBB26:
 473               	.LBB27:
 474               	.LBB28:
 475               		.loc 2 49 0
 476 0106 0115      		cp r16,__zero_reg__
 477 0108 1105      		cpc r17,__zero_reg__
 478 010a 01F0      		breq .L74
 479 010c 2F3F      		cpi r18,lo8(-1)
 480 010e 01F4      		brne .L75
 481 0110 81E0      		ldi r24,lo8(1)
 482 0112 4F3F      		cpi r20,lo8(-1)
 483 0114 01F4      		brne .L75
 484 0116 00C0      		rjmp .L42
 485               	.L74:
 486 0118 81E0      		ldi r24,lo8(1)
 487 011a 00C0      		rjmp .L42
 488               	.L75:
 489 011c 80E0      		ldi r24,0
 490               	.L42:
 491               	.LBE28:
 492               	.LBE27:
  50:../../tmk_core/common/keyboard.h **** static inline bool IS_PRESSED(keyevent_t event) { return (!IS_NOEVENT(event) && event.pressed); }
  51:../../tmk_core/common/keyboard.h **** static inline bool IS_RELEASED(keyevent_t event) { return (!IS_NOEVENT(event) && !event.pressed); }
 493               		.loc 2 51 0
 494 011e 80FD      		sbrc r24,0
 495 0120 00C0      		rjmp .L76
 496 0122 81E0      		ldi r24,lo8(1)
 497 0124 8D25      		eor r24,r13
 498 0126 00C0      		rjmp .L44
 499               	.L76:
 500 0128 80E0      		ldi r24,0
 501 012a 90E0      		ldi r25,0
 502               	.L44:
 503               	.LBE26:
 504               	.LBE25:
 116:../../tmk_core/common/action_tapping.c ****                     // Modifier should be retained till end of this tapping.
 505               		.loc 1 116 0
 506 012c B82F      		mov r27,r24
 507 012e B170      		andi r27,lo8(1)
 508 0130 CB2E      		mov r12,r27
 509 0132 80FF      		sbrs r24,0
 510 0134 00C0      		rjmp .L45
 511               	.LBB29:
 512               	.LBB30:
 318:../../tmk_core/common/action_tapping.c ****         if (KEYEQ(event.key, waiting_buffer[i].event.key) && event.pressed !=  waiting_buffer[i].ev
 513               		.loc 1 318 0 discriminator 1
 514 0136 E091 0000 		lds r30,waiting_buffer_tail
 515               	.LVL24:
 516 013a 3091 0000 		lds r19,waiting_buffer_head
 517               	.LVL25:
 518               	.L46:
 318:../../tmk_core/common/action_tapping.c ****         if (KEYEQ(event.key, waiting_buffer[i].event.key) && event.pressed !=  waiting_buffer[i].ev
 519               		.loc 1 318 0 is_stmt 0
 520 013e E317      		cp r30,r19
 521 0140 01F4      		brne .+2
 522 0142 00C0      		rjmp .L141
 319:../../tmk_core/common/action_tapping.c ****             return true;
 523               		.loc 1 319 0 is_stmt 1
 524 0144 F0E0      		ldi r31,0
 525 0146 CF01      		movw r24,r30
 526 0148 66E0      		ldi r22,lo8(6)
 527 014a 70E0      		ldi r23,0
 528 014c 0E94 0000 		call __mulhi3
 529 0150 DC01      		movw r26,r24
 530 0152 A050      		subi r26,lo8(-(waiting_buffer))
 531 0154 B040      		sbci r27,hi8(-(waiting_buffer))
 532 0156 1196      		adiw r26,1
 533 0158 8C91      		ld r24,X
 534 015a 1197      		sbiw r26,1
 535 015c 2813      		cpse r18,r24
 536 015e 00C0      		rjmp .L47
 537 0160 8C91      		ld r24,X
 538 0162 4813      		cpse r20,r24
 539 0164 00C0      		rjmp .L47
 540 0166 1296      		adiw r26,2
 541 0168 8C91      		ld r24,X
 542 016a D812      		cpse r13,r24
 543 016c 00C0      		rjmp .L45
 544               	.L47:
 318:../../tmk_core/common/action_tapping.c ****         if (KEYEQ(event.key, waiting_buffer[i].event.key) && event.pressed !=  waiting_buffer[i].ev
 545               		.loc 1 318 0
 546 016e 3196      		adiw r30,1
 547               	.LVL26:
 548 0170 E770      		andi r30,lo8(7)
 549 0172 00C0      		rjmp .L46
 550               	.L45:
 551               	.LBE30:
 552               	.LBE29:
 138:../../tmk_core/common/action_tapping.c ****                         tapping_key.tap.interrupted = true;
 553               		.loc 1 138 0
 554 0174 CD2C      		mov r12,r13
 555 0176 DD20      		tst r13
 556 0178 01F4      		brne .+2
 557 017a 00C0      		rjmp .L95
 558               	.LVL27:
 139:../../tmk_core/common/action_tapping.c ****                     }
 559               		.loc 1 139 0
 560 017c 8091 0000 		lds r24,tapping_key+5
 561 0180 8160      		ori r24,lo8(1<<0)
 562 0182 8093 0000 		sts tapping_key+5,r24
 142:../../tmk_core/common/action_tapping.c ****                 }
 563               		.loc 1 142 0
 564 0186 C12C      		mov r12,__zero_reg__
 565               	.LVL28:
 566 0188 00C0      		rjmp .L95
 567               	.LVL29:
 568               	.L39:
 147:../../tmk_core/common/action_tapping.c ****                     debug("Tapping: Tap release("); debug_dec(tapping_key.tap.count); debug(")\n");
 569               		.loc 1 147 0 discriminator 1
 570 018a 2613      		cpse r18,r22
 571 018c 00C0      		rjmp .L56
 147:../../tmk_core/common/action_tapping.c ****                     debug("Tapping: Tap release("); debug_dec(tapping_key.tap.count); debug(")\n");
 572               		.loc 1 147 0 is_stmt 0 discriminator 2
 573 018e 4513      		cpse r20,r21
 574 0190 00C0      		rjmp .L56
 147:../../tmk_core/common/action_tapping.c ****                     debug("Tapping: Tap release("); debug_dec(tapping_key.tap.count); debug(")\n");
 575               		.loc 1 147 0 discriminator 3
 576 0192 D110      		cpse r13,__zero_reg__
 577 0194 00C0      		rjmp .L56
 149:../../tmk_core/common/action_tapping.c ****                     process_action(keyp);
 578               		.loc 1 149 0 is_stmt 1
 579 0196 8091 0000 		lds r24,tapping_key+5
 580 019a D701      		movw r26,r14
 581 019c 00C0      		rjmp .L138
 582               	.L56:
 155:../../tmk_core/common/action_tapping.c ****                     if (tapping_key.tap.count > 1) {
 583               		.loc 1 155 0
 584 019e 4D87      		std Y+13,r20
 585 01a0 2E87      		std Y+14,r18
 586 01a2 DF86      		std Y+15,r13
 587 01a4 702F      		mov r23,r16
 588 01a6 198B      		std Y+17,r17
 589 01a8 088B      		std Y+16,r16
 590 01aa 522F      		mov r21,r18
 591 01ac 6D2D      		mov r22,r13
 592 01ae 8989      		ldd r24,Y+17
 593 01b0 0E94 0000 		call is_tap_key
 594               	.LVL30:
 595 01b4 8823      		tst r24
 596 01b6 01F0      		breq .L68
 155:../../tmk_core/common/action_tapping.c ****                     if (tapping_key.tap.count > 1) {
 597               		.loc 1 155 0 is_stmt 0 discriminator 1
 598 01b8 DD20      		tst r13
 599 01ba 01F0      		breq .L68
 156:../../tmk_core/common/action_tapping.c ****                         debug("Tapping: Start new tap with releasing last tap(>1).\n");
 600               		.loc 1 156 0 is_stmt 1
 601 01bc 2091 0000 		lds r18,tapping_key+5
 602 01c0 822F      		mov r24,r18
 603 01c2 8295      		swap r24
 604 01c4 8F70      		andi r24,lo8(15)
 605 01c6 90E0      		ldi r25,0
 606 01c8 0297      		sbiw r24,2
 607 01ca 04F0      		brlt .L59
 159:../../tmk_core/common/action_tapping.c ****                                 .tap = tapping_key.tap,
 608               		.loc 1 159 0
 609 01cc 8091 0000 		lds r24,tapping_key
 610 01d0 9091 0000 		lds r25,tapping_key+1
 611 01d4 9887      		std Y+8,r25
 612 01d6 8F83      		std Y+7,r24
 613 01d8 1986      		std Y+9,__zero_reg__
 614 01da 1B87      		std Y+11,r17
 615 01dc 0A87      		std Y+10,r16
 616 01de 2C87      		std Y+12,r18
 617 01e0 CE01      		movw r24,r28
 618 01e2 0796      		adiw r24,7
 619               	.L130:
 620 01e4 0E94 0000 		call process_action
 621               	.LVL31:
 622               	.L59:
 168:../../tmk_core/common/action_tapping.c ****                     waiting_buffer_scan_tap();
 623               		.loc 1 168 0
 624 01e8 86E0      		ldi r24,lo8(6)
 625 01ea F701      		movw r30,r14
 626 01ec A0E0      		ldi r26,lo8(tapping_key)
 627 01ee B0E0      		ldi r27,hi8(tapping_key)
 628               		0:
 629 01f0 0190      		ld r0,Z+
 630 01f2 0D92      		st X+,r0
 631 01f4 8A95      		dec r24
 632 01f6 01F4      		brne 0b
 169:../../tmk_core/common/action_tapping.c ****                     debug_tapping_key();
 633               		.loc 1 169 0
 634 01f8 0E94 0000 		call waiting_buffer_scan_tap
 635               	.LVL32:
 170:../../tmk_core/common/action_tapping.c ****                     return true;
 636               		.loc 1 170 0
 637 01fc 0E94 0000 		call debug_tapping_key
 638               	.LVL33:
 639 0200 00C0      		rjmp .L135
 640               	.LVL34:
 641               	.L60:
 192:../../tmk_core/common/action_tapping.c ****                     debug("Tapping: End. last timeout tap release(>0).");
 642               		.loc 1 192 0 discriminator 1
 643 0202 2617      		cp r18,r22
 644 0204 01F0      		breq .L142
 645               	.L61:
 199:../../tmk_core/common/action_tapping.c ****                     if (tapping_key.tap.count > 1) {
 646               		.loc 1 199 0
 647 0206 4D87      		std Y+13,r20
 648 0208 2E87      		std Y+14,r18
 649 020a DF86      		std Y+15,r13
 650 020c 702F      		mov r23,r16
 651 020e 198B      		std Y+17,r17
 652 0210 088B      		std Y+16,r16
 653 0212 522F      		mov r21,r18
 654 0214 6D2D      		mov r22,r13
 655 0216 8989      		ldd r24,Y+17
 656 0218 0E94 0000 		call is_tap_key
 657               	.LVL35:
 658 021c 8111      		cpse r24,__zero_reg__
 659 021e 00C0      		rjmp .L143
 660               	.LVL36:
 661               	.L68:
 177:../../tmk_core/common/action_tapping.c ****                     return true;
 662               		.loc 1 177 0
 663 0220 C701      		movw r24,r14
 664 0222 0E94 0000 		call process_action
 665               	.LVL37:
 666               	.L135:
 178:../../tmk_core/common/action_tapping.c ****                 }
 667               		.loc 1 178 0
 668 0226 CC24      		clr r12
 669 0228 C394      		inc r12
 670 022a 00C0      		rjmp .L95
 671               	.LVL38:
 672               	.L33:
 227:../../tmk_core/common/action_tapping.c ****             if (event.pressed) {
 673               		.loc 1 227 0 discriminator 1
 674 022c 0817      		cp r16,r24
 675 022e 1907      		cpc r17,r25
 676 0230 00F4      		brsh .+2
 677 0232 00C0      		rjmp .L63
 678 0234 F801      		movw r30,r16
 679 0236 E81B      		sub r30,r24
 680 0238 F90B      		sbc r31,r25
 681 023a CF01      		movw r24,r30
 682               	.L140:
 227:../../tmk_core/common/action_tapping.c ****             if (event.pressed) {
 683               		.loc 1 227 0 is_stmt 0 discriminator 2
 684 023c 883C      		cpi r24,-56
 685 023e 9105      		cpc r25,__zero_reg__
 686 0240 00F4      		brsh .+2
 687 0242 00C0      		rjmp .L94
 688 0244 C12C      		mov r12,__zero_reg__
 267:../../tmk_core/common/action_tapping.c ****             tapping_key = (keyrecord_t){};
 689               		.loc 1 267 0 is_stmt 1 discriminator 2
 690 0246 702F      		mov r23,r16
 691 0248 198B      		std Y+17,r17
 692 024a 088B      		std Y+16,r16
 693 024c 522F      		mov r21,r18
 694 024e 6D2D      		mov r22,r13
 695 0250 8989      		ldd r24,Y+17
 696 0252 0E94 0000 		call debug_event
 697               	.LVL39:
 698               	.L134:
 188:../../tmk_core/common/action_tapping.c ****                 debug_tapping_key();
 699               		.loc 1 188 0
 700 0256 E0E0      		ldi r30,lo8(tapping_key)
 701 0258 F0E0      		ldi r31,hi8(tapping_key)
 702 025a 86E0      		ldi r24,lo8(6)
 703 025c DF01      		movw r26,r30
 704               		0:
 705 025e 1D92      		st X+,__zero_reg__
 706 0260 8A95      		dec r24
 707 0262 01F4      		brne 0b
 708               	.L133:
 189:../../tmk_core/common/action_tapping.c ****                 return false;
 709               		.loc 1 189 0
 710 0264 0E94 0000 		call debug_tapping_key
 711               	.LVL40:
 190:../../tmk_core/common/action_tapping.c ****             }  else {
 712               		.loc 1 190 0
 713 0268 00C0      		rjmp .L95
 714               	.LVL41:
 715               	.L142:
 192:../../tmk_core/common/action_tapping.c ****                     debug("Tapping: End. last timeout tap release(>0).");
 716               		.loc 1 192 0 discriminator 2
 717 026a 4513      		cpse r20,r21
 718 026c 00C0      		rjmp .L61
 192:../../tmk_core/common/action_tapping.c ****                     debug("Tapping: End. last timeout tap release(>0).");
 719               		.loc 1 192 0 is_stmt 0 discriminator 3
 720 026e D110      		cpse r13,__zero_reg__
 721 0270 00C0      		rjmp .L61
 194:../../tmk_core/common/action_tapping.c ****                     process_action(keyp);
 722               		.loc 1 194 0 is_stmt 1
 723 0272 8091 0000 		lds r24,tapping_key+5
 724 0276 F701      		movw r30,r14
 725 0278 8583      		std Z+5,r24
 195:../../tmk_core/common/action_tapping.c ****                     tapping_key = (keyrecord_t){};
 726               		.loc 1 195 0
 727 027a C701      		movw r24,r14
 728 027c 0E94 0000 		call process_action
 729               	.LVL42:
 196:../../tmk_core/common/action_tapping.c ****                     return true;
 730               		.loc 1 196 0
 731 0280 86E0      		ldi r24,lo8(6)
 732 0282 E0E0      		ldi r30,lo8(tapping_key)
 733 0284 F0E0      		ldi r31,hi8(tapping_key)
 734 0286 DF01      		movw r26,r30
 735               		0:
 736 0288 1D92      		st X+,__zero_reg__
 737 028a 8A95      		dec r24
 738 028c 01F4      		brne 0b
 197:../../tmk_core/common/action_tapping.c ****                 }
 739               		.loc 1 197 0
 740 028e CA2C      		mov r12,r10
 741 0290 00C0      		rjmp .L95
 742               	.LVL43:
 743               	.L143:
 199:../../tmk_core/common/action_tapping.c ****                     if (tapping_key.tap.count > 1) {
 744               		.loc 1 199 0 discriminator 1
 745 0292 DD20      		tst r13
 746 0294 01F0      		breq .L68
 200:../../tmk_core/common/action_tapping.c ****                         debug("Tapping: Start new tap with releasing last timeout tap(>1).\n");
 747               		.loc 1 200 0
 748 0296 2091 0000 		lds r18,tapping_key+5
 749 029a 822F      		mov r24,r18
 750 029c 8295      		swap r24
 751 029e 8F70      		andi r24,lo8(15)
 752 02a0 90E0      		ldi r25,0
 753 02a2 0297      		sbiw r24,2
 754 02a4 04F4      		brge .+2
 755 02a6 00C0      		rjmp .L59
 203:../../tmk_core/common/action_tapping.c ****                                 .tap = tapping_key.tap,
 756               		.loc 1 203 0
 757 02a8 8091 0000 		lds r24,tapping_key
 758 02ac 9091 0000 		lds r25,tapping_key+1
 759 02b0 9A83      		std Y+2,r25
 760 02b2 8983      		std Y+1,r24
 761 02b4 1B82      		std Y+3,__zero_reg__
 762 02b6 1D83      		std Y+5,r17
 763 02b8 0C83      		std Y+4,r16
 764 02ba 2E83      		std Y+6,r18
 765 02bc CE01      		movw r24,r28
 766 02be 0196      		adiw r24,1
 767 02c0 00C0      		rjmp .L130
 768               	.LVL44:
 769               	.L63:
 227:../../tmk_core/common/action_tapping.c ****             if (event.pressed) {
 770               		.loc 1 227 0 discriminator 2
 771 02c2 8095      		com r24
 772 02c4 9095      		com r25
 773 02c6 800F      		add r24,r16
 774 02c8 911F      		adc r25,r17
 775 02ca 00C0      		rjmp .L140
 776               	.L94:
 228:../../tmk_core/common/action_tapping.c ****                 if (IS_TAPPING_KEY(event.key)) {
 777               		.loc 1 228 0
 778 02cc CD2C      		mov r12,r13
 779 02ce DD20      		tst r13
 780 02d0 01F4      		brne .+2
 781 02d2 00C0      		rjmp .L68
 782               	.LVL45:
 229:../../tmk_core/common/action_tapping.c ****                     if (!tapping_key.tap.interrupted && tapping_key.tap.count > 0) {
 783               		.loc 1 229 0 discriminator 1
 784 02d4 2613      		cpse r18,r22
 785 02d6 00C0      		rjmp .L69
 229:../../tmk_core/common/action_tapping.c ****                     if (!tapping_key.tap.interrupted && tapping_key.tap.count > 0) {
 786               		.loc 1 229 0 is_stmt 0 discriminator 2
 787 02d8 4513      		cpse r20,r21
 788 02da 00C0      		rjmp .L69
 230:../../tmk_core/common/action_tapping.c ****                         // sequential tap.
 789               		.loc 1 230 0 is_stmt 1
 790 02dc 2091 0000 		lds r18,tapping_key+5
 791               	.LVL46:
 792 02e0 20FD      		sbrc r18,0
 793 02e2 00C0      		rjmp .L70
 230:../../tmk_core/common/action_tapping.c ****                         // sequential tap.
 794               		.loc 1 230 0 is_stmt 0 discriminator 1
 795 02e4 822F      		mov r24,r18
 796 02e6 8295      		swap r24
 797 02e8 8F70      		andi r24,lo8(15)
 798 02ea 482F      		mov r20,r24
 799               	.LVL47:
 800 02ec 50E0      		ldi r21,0
 801 02ee 4115      		cp r20,__zero_reg__
 802 02f0 5105      		cpc r21,__zero_reg__
 803 02f2 01F0      		breq .L70
 232:../../tmk_core/common/action_tapping.c ****                         if (keyp->tap.count < 15) keyp->tap.count += 1;
 804               		.loc 1 232 0 is_stmt 1
 805 02f4 D701      		movw r26,r14
 806 02f6 1596      		adiw r26,5
 807 02f8 2C93      		st X,r18
 808 02fa 1597      		sbiw r26,5
 233:../../tmk_core/common/action_tapping.c ****                         debug("Tapping: Tap press("); debug_dec(keyp->tap.count); debug(")\n");
 809               		.loc 1 233 0
 810 02fc 4F30      		cpi r20,15
 811 02fe 5105      		cpc r21,__zero_reg__
 812 0300 01F0      		breq .L71
 233:../../tmk_core/common/action_tapping.c ****                         debug("Tapping: Tap press("); debug_dec(keyp->tap.count); debug(")\n");
 813               		.loc 1 233 0 is_stmt 0 discriminator 1
 814 0302 8F5F      		subi r24,lo8(-(1))
 815 0304 982F      		mov r25,r24
 816 0306 9295      		swap r25
 817 0308 907F      		andi r25,lo8(-16)
 818 030a 822F      		mov r24,r18
 819 030c 8F70      		andi r24,lo8(15)
 820 030e 892B      		or r24,r25
 821               	.LVL48:
 822               	.L138:
 823 0310 1596      		adiw r26,5
 824 0312 8C93      		st X,r24
 825               	.L71:
 235:../../tmk_core/common/action_tapping.c ****                         tapping_key = *keyp;
 826               		.loc 1 235 0 is_stmt 1
 827 0314 C701      		movw r24,r14
 828 0316 0E94 0000 		call process_action
 829               	.LVL49:
 236:../../tmk_core/common/action_tapping.c ****                         debug_tapping_key();
 830               		.loc 1 236 0
 831 031a 86E0      		ldi r24,lo8(6)
 832 031c F701      		movw r30,r14
 833 031e A0E0      		ldi r26,lo8(tapping_key)
 834 0320 B0E0      		ldi r27,hi8(tapping_key)
 835               		0:
 836 0322 0190      		ld r0,Z+
 837 0324 0D92      		st X+,r0
 838 0326 8A95      		dec r24
 839 0328 01F4      		brne 0b
 840 032a 00C0      		rjmp .L133
 841               	.LVL50:
 842               	.L70:
 241:../../tmk_core/common/action_tapping.c ****                         return true;
 843               		.loc 1 241 0
 844 032c 86E0      		ldi r24,lo8(6)
 845 032e F701      		movw r30,r14
 846 0330 A0E0      		ldi r26,lo8(tapping_key)
 847 0332 B0E0      		ldi r27,hi8(tapping_key)
 848               		0:
 849 0334 0190      		ld r0,Z+
 850 0336 0D92      		st X+,r0
 851 0338 8A95      		dec r24
 852 033a 01F4      		brne 0b
 242:../../tmk_core/common/action_tapping.c ****                     }
 853               		.loc 1 242 0
 854 033c 00C0      		rjmp .L95
 855               	.LVL51:
 856               	.L69:
 244:../../tmk_core/common/action_tapping.c ****                     // Sequential tap can be interfered with other tap key.
 857               		.loc 1 244 0
 858 033e 4D87      		std Y+13,r20
 859 0340 2E87      		std Y+14,r18
 860 0342 DF86      		std Y+15,r13
 861 0344 702F      		mov r23,r16
 862 0346 198B      		std Y+17,r17
 863 0348 088B      		std Y+16,r16
 864 034a 522F      		mov r21,r18
 865 034c 6D2D      		mov r22,r13
 866 034e 8989      		ldd r24,Y+17
 867 0350 0E94 0000 		call is_tap_key
 868               	.LVL52:
 869 0354 8111      		cpse r24,__zero_reg__
 870 0356 00C0      		rjmp .L59
 254:../../tmk_core/common/action_tapping.c ****                     process_action(keyp);
 871               		.loc 1 254 0
 872 0358 8091 0000 		lds r24,tapping_key+5
 873 035c 8160      		ori r24,lo8(1<<0)
 874 035e 8093 0000 		sts tapping_key+5,r24
 255:../../tmk_core/common/action_tapping.c ****                     return true;
 875               		.loc 1 255 0
 876 0362 C701      		movw r24,r14
 877 0364 0E94 0000 		call process_action
 878               	.LVL53:
 256:../../tmk_core/common/action_tapping.c ****                 }
 879               		.loc 1 256 0
 880 0368 00C0      		rjmp .L95
 881               	.LVL54:
 882               	.L32:
 275:../../tmk_core/common/action_tapping.c ****             debug("Tapping: Start(Press tap key).\n");
 883               		.loc 1 275 0
 884 036a DD20      		tst r13
 885 036c 01F4      		brne .+2
 886 036e 00C0      		rjmp .L68
 275:../../tmk_core/common/action_tapping.c ****             debug("Tapping: Start(Press tap key).\n");
 887               		.loc 1 275 0 is_stmt 0 discriminator 1
 888 0370 4D87      		std Y+13,r20
 889 0372 2E87      		std Y+14,r18
 890 0374 DF86      		std Y+15,r13
 891 0376 702F      		mov r23,r16
 892 0378 198B      		std Y+17,r17
 893 037a 088B      		std Y+16,r16
 894 037c 522F      		mov r21,r18
 895 037e 6D2D      		mov r22,r13
 896 0380 8989      		ldd r24,Y+17
 897 0382 0E94 0000 		call is_tap_key
 898               	.LVL55:
 899 0386 8823      		tst r24
 900 0388 01F4      		brne .+2
 901 038a 00C0      		rjmp .L68
 902 038c 00C0      		rjmp .L59
 903               	.LVL56:
 904               	.L141:
 905               	.LBB31:
 118:../../tmk_core/common/action_tapping.c ****                     switch (action.kind.id) {
 906               		.loc 1 118 0 is_stmt 1
 907 038e 702F      		mov r23,r16
 908 0390 198B      		std Y+17,r17
 909 0392 088B      		std Y+16,r16
 910 0394 522F      		mov r21,r18
 911 0396 6D2D      		mov r22,r13
 912 0398 8989      		ldd r24,Y+17
 913 039a 0E94 0000 		call layer_switch_get_action
 914               	.LVL57:
 119:../../tmk_core/common/action_tapping.c ****                         case ACT_LMODS:
 915               		.loc 1 119 0
 916 039e 292F      		mov r18,r25
 917 03a0 2295      		swap r18
 918 03a2 2F70      		andi r18,lo8(15)
 919 03a4 2230      		cpi r18,lo8(2)
 920 03a6 00F4      		brsh .L144
 122:../../tmk_core/common/action_tapping.c ****                             if (IS_MOD(action.key.code)) return false;
 921               		.loc 1 122 0
 922 03a8 9F70      		andi r25,lo8(15)
 923               	.LVL58:
 924 03aa 01F0      		breq .L55
 122:../../tmk_core/common/action_tapping.c ****                             if (IS_MOD(action.key.code)) return false;
 925               		.loc 1 122 0 is_stmt 0 discriminator 1
 926 03ac 8111      		cpse r24,__zero_reg__
 927 03ae 00C0      		rjmp .L55
 928 03b0 00C0      		rjmp .L52
 929               	.LVL59:
 930               	.L144:
 119:../../tmk_core/common/action_tapping.c ****                         case ACT_LMODS:
 931               		.loc 1 119 0 is_stmt 1
 932 03b2 2430      		cpi r18,lo8(4)
 933 03b4 00F4      		brsh .L53
 127:../../tmk_core/common/action_tapping.c ****                             if (IS_MOD(action.key.code)) return false;
 934               		.loc 1 127 0
 935 03b6 9F70      		andi r25,lo8(15)
 936               	.LVL60:
 937 03b8 01F4      		brne .L145
 938               	.L55:
 128:../../tmk_core/common/action_tapping.c ****                             break;
 939               		.loc 1 128 0
 940 03ba 805E      		subi r24,lo8(-(32))
 941               	.LVL61:
 942 03bc 8830      		cpi r24,lo8(8)
 943 03be 00F0      		brlo .L52
 944               	.LVL62:
 945               	.L53:
 133:../../tmk_core/common/action_tapping.c ****                     return true;
 946               		.loc 1 133 0
 947 03c0 C701      		movw r24,r14
 948               	.LVL63:
 949 03c2 0E94 0000 		call process_action
 950               	.LVL64:
 134:../../tmk_core/common/action_tapping.c ****                 }
 951               		.loc 1 134 0
 952 03c6 BC2C      		mov r11,r12
 953               	.L52:
 954               	.LVL65:
 955 03c8 CB2C      		mov r12,r11
 956 03ca 00C0      		rjmp .L95
 957               	.LVL66:
 958               	.L145:
 127:../../tmk_core/common/action_tapping.c ****                             if (IS_MOD(action.key.code)) return false;
 959               		.loc 1 127 0 discriminator 1
 960 03cc F701      		movw r30,r14
 961 03ce 9581      		ldd r25,Z+5
 962 03d0 907F      		andi r25,lo8(-16)
 963 03d2 01F4      		brne .L55
 964 03d4 00C0      		rjmp .L52
 965               	.LVL67:
 966               	.L95:
 967               	.LBE31:
 286:../../tmk_core/common/action_tapping.c **** 
 968               		.loc 1 286 0
 969 03d6 8C2D      		mov r24,r12
 970               	.LVL68:
 971               	/* epilogue start */
 972 03d8 6196      		adiw r28,17
 973 03da 0FB6      		in __tmp_reg__,__SREG__
 974 03dc F894      		cli
 975 03de DEBF      		out __SP_H__,r29
 976 03e0 0FBE      		out __SREG__,__tmp_reg__
 977 03e2 CDBF      		out __SP_L__,r28
 978 03e4 DF91      		pop r29
 979 03e6 CF91      		pop r28
 980 03e8 1F91      		pop r17
 981 03ea 0F91      		pop r16
 982               	.LVL69:
 983 03ec FF90      		pop r15
 984 03ee EF90      		pop r14
 985               	.LVL70:
 986 03f0 DF90      		pop r13
 987               	.LVL71:
 988 03f2 CF90      		pop r12
 989 03f4 BF90      		pop r11
 990 03f6 AF90      		pop r10
 991 03f8 0895      		ret
 992               		.cfi_endproc
 993               	.LFE5:
 995               		.section	.text.action_tapping_process,"ax",@progbits
 996               	.global	action_tapping_process
 998               	action_tapping_process:
 999               	.LFB4:
  39:../../tmk_core/common/action_tapping.c ****     if (process_tapping(&record)) {
 1000               		.loc 1 39 0
 1001               		.cfi_startproc
 1002 0000 CF93      		push r28
 1003               	.LCFI17:
 1004               		.cfi_def_cfa_offset 3
 1005               		.cfi_offset 28, -2
 1006 0002 DF93      		push r29
 1007               	.LCFI18:
 1008               		.cfi_def_cfa_offset 4
 1009               		.cfi_offset 29, -3
 1010 0004 CDB7      		in r28,__SP_L__
 1011 0006 DEB7      		in r29,__SP_H__
 1012               	.LCFI19:
 1013               		.cfi_def_cfa_register 28
 1014 0008 2C97      		sbiw r28,12
 1015               	.LCFI20:
 1016               		.cfi_def_cfa_offset 16
 1017 000a 0FB6      		in __tmp_reg__,__SREG__
 1018 000c F894      		cli
 1019 000e DEBF      		out __SP_H__,r29
 1020 0010 0FBE      		out __SREG__,__tmp_reg__
 1021 0012 CDBF      		out __SP_L__,r28
 1022               	/* prologue: function */
 1023               	/* frame size = 12 */
 1024               	/* stack size = 14 */
 1025               	.L__stack_usage = 14
 1026 0014 4F83      		std Y+7,r20
 1027 0016 5887      		std Y+8,r21
 1028 0018 6987      		std Y+9,r22
 1029 001a 7A87      		std Y+10,r23
 1030 001c 8B87      		std Y+11,r24
 1031 001e 9C87      		std Y+12,r25
  40:../../tmk_core/common/action_tapping.c ****         if (!IS_NOEVENT(record.event)) {
 1032               		.loc 1 40 0
 1033 0020 CE01      		movw r24,r28
 1034 0022 0796      		adiw r24,7
 1035 0024 0E94 0000 		call process_tapping
 1036               	.LVL72:
 1037 0028 8823      		tst r24
 1038 002a 01F0      		breq .L147
 1039 002c 9F81      		ldd r25,Y+7
 1040 002e 8885      		ldd r24,Y+8
 1041               	.LBB40:
 1042               	.LBB41:
  49:../../tmk_core/common/keyboard.h **** static inline bool IS_PRESSED(keyevent_t event) { return (!IS_NOEVENT(event) && event.pressed); }
 1043               		.loc 2 49 0
 1044 0030 2A85      		ldd r18,Y+10
 1045 0032 3B85      		ldd r19,Y+11
 1046 0034 232B      		or r18,r19
 1047 0036 01F0      		breq .L160
 1048 0038 8F3F      		cpi r24,lo8(-1)
 1049 003a 01F4      		brne .L161
 1050 003c 81E0      		ldi r24,lo8(1)
 1051 003e 9F3F      		cpi r25,lo8(-1)
 1052 0040 01F4      		brne .L161
 1053 0042 00C0      		rjmp .L148
 1054               	.L160:
 1055 0044 81E0      		ldi r24,lo8(1)
 1056 0046 00C0      		rjmp .L148
 1057               	.L161:
 1058 0048 80E0      		ldi r24,0
 1059               	.L148:
 1060               	.LBE41:
 1061               	.LBE40:
  41:../../tmk_core/common/action_tapping.c ****             debug("processed: "); debug_record(record); debug("\n");
 1062               		.loc 1 41 0
 1063 004a 80FD      		sbrc r24,0
 1064 004c 00C0      		rjmp .L155
  42:../../tmk_core/common/action_tapping.c ****         }
 1065               		.loc 1 42 0
 1066 004e 4F81      		ldd r20,Y+7
 1067 0050 5885      		ldd r21,Y+8
 1068 0052 6985      		ldd r22,Y+9
 1069 0054 7A85      		ldd r23,Y+10
 1070 0056 8B85      		ldd r24,Y+11
 1071 0058 9C85      		ldd r25,Y+12
 1072 005a 0E94 0000 		call debug_record
 1073               	.LVL73:
 1074 005e 00C0      		rjmp .L155
 1075               	.L147:
 1076 0060 86E0      		ldi r24,lo8(6)
 1077 0062 FE01      		movw r30,r28
 1078 0064 3796      		adiw r30,7
 1079 0066 DE01      		movw r26,r28
 1080 0068 1196      		adiw r26,1
 1081               		0:
 1082 006a 0190      		ld r0,Z+
 1083 006c 0D92      		st X+,r0
 1084 006e 8A95      		dec r24
 1085 0070 01F4      		brne 0b
 1086 0072 FF81      		ldd r31,Y+7
 1087               	.LVL74:
 1088 0074 E885      		ldd r30,Y+8
 1089               	.LVL75:
 1090 0076 6A85      		ldd r22,Y+10
 1091 0078 7B85      		ldd r23,Y+11
 1092               	.LVL76:
 1093               	.LBB42:
 1094               	.LBB43:
 1095               	.LBB44:
 1096               	.LBB45:
  49:../../tmk_core/common/keyboard.h **** static inline bool IS_PRESSED(keyevent_t event) { return (!IS_NOEVENT(event) && event.pressed); }
 1097               		.loc 2 49 0
 1098 007a 6115      		cp r22,__zero_reg__
 1099 007c 7105      		cpc r23,__zero_reg__
 1100 007e 01F0      		breq .L162
 1101 0080 EF3F      		cpi r30,lo8(-1)
 1102 0082 01F4      		brne .L163
 1103 0084 81E0      		ldi r24,lo8(1)
 1104 0086 FF3F      		cpi r31,lo8(-1)
 1105 0088 01F4      		brne .L163
 1106 008a 00C0      		rjmp .L152
 1107               	.L162:
 1108 008c 81E0      		ldi r24,lo8(1)
 1109 008e 00C0      		rjmp .L152
 1110               	.L163:
 1111 0090 80E0      		ldi r24,0
 1112               	.L152:
 1113               	.LBE45:
 1114               	.LBE44:
 294:../../tmk_core/common/action_tapping.c ****         return true;
 1115               		.loc 1 294 0
 1116 0092 80FD      		sbrc r24,0
 1117 0094 00C0      		rjmp .L155
 298:../../tmk_core/common/action_tapping.c ****         debug("waiting_buffer_enq: Over flow.\n");
 1118               		.loc 1 298 0
 1119 0096 8091 0000 		lds r24,waiting_buffer_head
 1120 009a 90E0      		ldi r25,0
 1121 009c 9C01      		movw r18,r24
 1122 009e 2F5F      		subi r18,-1
 1123 00a0 3F4F      		sbci r19,-1
 1124 00a2 2770      		andi r18,7
 1125 00a4 3327      		clr r19
 1126 00a6 4091 0000 		lds r20,waiting_buffer_tail
 1127 00aa 50E0      		ldi r21,0
 1128 00ac 2417      		cp r18,r20
 1129 00ae 3507      		cpc r19,r21
 1130 00b0 01F4      		brne .+2
 1131 00b2 00C0      		rjmp .L154
 303:../../tmk_core/common/action_tapping.c ****     waiting_buffer_head = (waiting_buffer_head + 1) % WAITING_BUFFER_SIZE;
 1132               		.loc 1 303 0
 1133 00b4 F983      		std Y+1,r31
 1134 00b6 EA83      		std Y+2,r30
 1135 00b8 7D83      		std Y+5,r23
 1136 00ba 6C83      		std Y+4,r22
 1137 00bc 66E0      		ldi r22,lo8(6)
 1138 00be 70E0      		ldi r23,0
 1139               	.LVL77:
 1140 00c0 0E94 0000 		call __mulhi3
 1141 00c4 DC01      		movw r26,r24
 1142 00c6 A050      		subi r26,lo8(-(waiting_buffer))
 1143 00c8 B040      		sbci r27,hi8(-(waiting_buffer))
 1144 00ca 96E0      		ldi r25,lo8(6)
 1145 00cc FE01      		movw r30,r28
 1146               	.LVL78:
 1147 00ce 3196      		adiw r30,1
 1148               		0:
 1149 00d0 0190      		ld r0,Z+
 1150 00d2 0D92      		st X+,r0
 1151 00d4 9A95      		dec r25
 1152 00d6 01F4      		brne 0b
 304:../../tmk_core/common/action_tapping.c **** 
 1153               		.loc 1 304 0
 1154 00d8 2093 0000 		sts waiting_buffer_head,r18
 306:../../tmk_core/common/action_tapping.c ****     return true;
 1155               		.loc 1 306 0
 1156 00dc 0E94 0000 		call debug_waiting_buffer
 1157               	.LVL79:
 1158 00e0 00C0      		rjmp .L155
 1159               	.LVL80:
 1160               	.L158:
 1161               	.LBE43:
 1162               	.LBE42:
  59:../../tmk_core/common/action_tapping.c ****             debug("processed: waiting_buffer["); debug_dec(waiting_buffer_tail); debug("] = ");
 1163               		.loc 1 59 0
 1164 00e2 90E0      		ldi r25,0
 1165 00e4 66E0      		ldi r22,lo8(6)
 1166 00e6 70E0      		ldi r23,0
 1167 00e8 0E94 0000 		call __mulhi3
 1168 00ec 8050      		subi r24,lo8(-(waiting_buffer))
 1169 00ee 9040      		sbci r25,hi8(-(waiting_buffer))
 1170 00f0 0E94 0000 		call process_tapping
 1171               	.LVL81:
 1172 00f4 8823      		tst r24
 1173 00f6 01F0      		breq .L146
  61:../../tmk_core/common/action_tapping.c ****         } else {
 1174               		.loc 1 61 0
 1175 00f8 8091 0000 		lds r24,waiting_buffer_tail
 1176 00fc 90E0      		ldi r25,0
 1177 00fe 66E0      		ldi r22,lo8(6)
 1178 0100 70E0      		ldi r23,0
 1179 0102 0E94 0000 		call __mulhi3
 1180 0106 FC01      		movw r30,r24
 1181 0108 E050      		subi r30,lo8(-(waiting_buffer))
 1182 010a F040      		sbci r31,hi8(-(waiting_buffer))
 1183 010c 4081      		ld r20,Z
 1184 010e 5181      		ldd r21,Z+1
 1185 0110 6281      		ldd r22,Z+2
 1186 0112 7381      		ldd r23,Z+3
 1187 0114 8481      		ldd r24,Z+4
 1188 0116 9581      		ldd r25,Z+5
 1189 0118 0E94 0000 		call debug_record
 1190               	.LVL82:
  58:../../tmk_core/common/action_tapping.c ****         if (process_tapping(&waiting_buffer[waiting_buffer_tail])) {
 1191               		.loc 1 58 0
 1192 011c 8091 0000 		lds r24,waiting_buffer_tail
 1193 0120 90E0      		ldi r25,0
 1194 0122 0196      		adiw r24,1
 1195 0124 8770      		andi r24,7
 1196 0126 9927      		clr r25
 1197 0128 8093 0000 		sts waiting_buffer_tail,r24
 1198               	.L155:
  58:../../tmk_core/common/action_tapping.c ****         if (process_tapping(&waiting_buffer[waiting_buffer_tail])) {
 1199               		.loc 1 58 0 is_stmt 0 discriminator 1
 1200 012c 8091 0000 		lds r24,waiting_buffer_tail
 1201 0130 9091 0000 		lds r25,waiting_buffer_head
 1202 0134 8913      		cpse r24,r25
 1203 0136 00C0      		rjmp .L158
 1204 0138 00C0      		rjmp .L146
 1205               	.LVL83:
 1206               	.L154:
  48:../../tmk_core/common/action_tapping.c ****             waiting_buffer_clear();
 1207               		.loc 1 48 0 is_stmt 1
 1208 013a 0E94 0000 		call clear_keyboard
 1209               	.LVL84:
 1210               	.LBB46:
 1211               	.LBB47:
 312:../../tmk_core/common/action_tapping.c ****     waiting_buffer_tail = 0;
 1212               		.loc 1 312 0
 1213 013e 1092 0000 		sts waiting_buffer_head,__zero_reg__
 313:../../tmk_core/common/action_tapping.c **** }
 1214               		.loc 1 313 0
 1215 0142 1092 0000 		sts waiting_buffer_tail,__zero_reg__
 1216               	.LBE47:
 1217               	.LBE46:
  50:../../tmk_core/common/action_tapping.c ****         }
 1218               		.loc 1 50 0
 1219 0146 E0E0      		ldi r30,lo8(tapping_key)
 1220 0148 F0E0      		ldi r31,hi8(tapping_key)
 1221 014a 86E0      		ldi r24,lo8(6)
 1222 014c DF01      		movw r26,r30
 1223               		0:
 1224 014e 1D92      		st X+,__zero_reg__
 1225 0150 8A95      		dec r24
 1226 0152 01F4      		brne 0b
 1227               	.L146:
 1228               	/* epilogue start */
  69:../../tmk_core/common/action_tapping.c **** 
 1229               		.loc 1 69 0
 1230 0154 2C96      		adiw r28,12
 1231 0156 0FB6      		in __tmp_reg__,__SREG__
 1232 0158 F894      		cli
 1233 015a DEBF      		out __SP_H__,r29
 1234 015c 0FBE      		out __SREG__,__tmp_reg__
 1235 015e CDBF      		out __SP_L__,r28
 1236 0160 DF91      		pop r29
 1237 0162 CF91      		pop r28
 1238 0164 0895      		ret
 1239               		.cfi_endproc
 1240               	.LFE4:
 1242               		.section	.bss.waiting_buffer_tail,"aw",@nobits
 1245               	waiting_buffer_tail:
 1246 0000 00        		.zero	1
 1247               		.section	.bss.waiting_buffer_head,"aw",@nobits
 1250               	waiting_buffer_head:
 1251 0000 00        		.zero	1
 1252               		.section	.bss.waiting_buffer,"aw",@nobits
 1255               	waiting_buffer:
 1256 0000 0000 0000 		.zero	48
 1256      0000 0000 
 1256      0000 0000 
 1256      0000 0000 
 1256      0000 0000 
 1257               		.section	.bss.tapping_key,"aw",@nobits
 1260               	tapping_key:
 1261 0000 0000 0000 		.zero	6
 1261      0000 
 1262               		.text
 1263               	.Letext0:
 1264               		.file 3 "/usr/lib/avr/include/stdint.h"
 1265               		.file 4 "../../tmk_core/common/keycode.h"
 1266               		.file 5 "../../tmk_core/common/action_code.h"
 1267               		.file 6 "../../tmk_core/common/action.h"
 1268               		.file 7 "../../tmk_core/common/action_layer.h"
DEFINED SYMBOLS
                            *ABS*:0000000000000000 action_tapping.c
     /tmp/ccZz2J4P.s:2      *ABS*:000000000000003e __SP_H__
     /tmp/ccZz2J4P.s:3      *ABS*:000000000000003d __SP_L__
     /tmp/ccZz2J4P.s:4      *ABS*:000000000000003f __SREG__
     /tmp/ccZz2J4P.s:5      *ABS*:0000000000000000 __tmp_reg__
     /tmp/ccZz2J4P.s:6      *ABS*:0000000000000001 __zero_reg__
     /tmp/ccZz2J4P.s:12     .text.debug_waiting_buffer:0000000000000000 debug_waiting_buffer
     /tmp/ccZz2J4P.s:1245   .bss.waiting_buffer_tail:0000000000000000 waiting_buffer_tail
     /tmp/ccZz2J4P.s:1250   .bss.waiting_buffer_head:0000000000000000 waiting_buffer_head
     /tmp/ccZz2J4P.s:1255   .bss.waiting_buffer:0000000000000000 waiting_buffer
     /tmp/ccZz2J4P.s:74     .text.debug_tapping_key:0000000000000000 debug_tapping_key
     /tmp/ccZz2J4P.s:1260   .bss.tapping_key:0000000000000000 tapping_key
     /tmp/ccZz2J4P.s:96     .text.waiting_buffer_scan_tap:0000000000000000 waiting_buffer_scan_tap
     /tmp/ccZz2J4P.s:266    .text.process_tapping:0000000000000000 process_tapping
     /tmp/ccZz2J4P.s:998    .text.action_tapping_process:0000000000000000 action_tapping_process

UNDEFINED SYMBOLS
__mulhi3
debug_record
process_action
debug_event
is_tap_key
layer_switch_get_action
clear_keyboard
__do_clear_bss
